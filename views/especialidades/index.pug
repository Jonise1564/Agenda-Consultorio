//- extends ../layout

//- block contenido
//-     a(href="/medicos" class="btn btn-outline-dark") Volver
//-     .container
//-         h1 Especialidades
        
//-         if successMessage
//-             .alert.alert-success= successMessage
//-         a.btn.btn-primary(href="/especialidades/create") Agregar Especialidad

//-         //- Campo de búsqueda
//-         input#search(type="text" class="form-control" placeholder="Buscar especialidad..." onkeyup="filterEspecialidades()")

//-         ul.list-group#especialidades-list
//-             each especialidad in especialidades
//-                 li.list-group-item(data-nombre=especialidad.nombre.toLowerCase())
//-                     //- Nombre de la especialidad
//-                     span.especialidad-nombre= especialidad.nombre

//-                     //- Formulario de edición (oculto inicialmente)
//-                     form.edit-form(action=`/especialidades/update/${especialidad.id}`, method='post' style="display: none;")
//-                         input.form-control(type="text" name="nombre" value=especialidad.nombre required)
//-                         button.btn.btn-success(type="submit") Guardar

//-                     //- Grupo de botones
//-                     .button-group(style="display: flex; gap: 10px; margin-top: 5px;")
//-                         button.btn.btn-primary(type="button" onclick=`toggleEditForm(${especialidad.id})` class="btn btn-primary btn-sm") Modificar

//-                         if especialidad.estado == 1                       
//-                             form(action=`/especialidades/inactivar/${especialidad.id}`, method='post' id=`inactivar-form-${especialidad.id}`)
//-                                 button(type='submit' class="btn btn-danger btn-sm") Inactivar
//-                         else
//-                             form(action=`/especialidades/activar/${especialidad.id}`, method='post' id=`activar-form-${especialidad.id}`)
//-                                 button(type='submit' class="btn btn-success btn-sm") Activar

//-     //- Script para mostrar/ocultar el formulario de edición y permitir solo uno a la vez
//-     script.
//-         let activeEditForm = null;

//-         function toggleEditForm(id) {
//-             const editForm = document.querySelector(`form.edit-form[action='/especialidades/update/${id}']`);
//-             const nombreSpan = editForm.previousElementSibling;

//-             // Si hay un formulario activo y no es el actual, lo cerramos
//-             if (activeEditForm && activeEditForm !== editForm) {
//-                 activeEditForm.style.display = 'none';
//-                 activeEditForm.previousElementSibling.style.display = 'block';
//-             }

//-             // Alternamos el estado del formulario actual
//-             if (editForm.style.display === 'none') {
//-                 editForm.style.display = 'block';
//-                 nombreSpan.style.display = 'none';
//-                 activeEditForm = editForm; // Actualizamos el formulario activo
//-             } else {
//-                 editForm.style.display = 'none';
//-                 nombreSpan.style.display = 'block';
//-                 activeEditForm = null; // Ningún formulario está activo
//-             }
//-         }

//-         function filterEspecialidades() {
//-             const searchInput = document.getElementById('search').value.toLowerCase();
//-             const especialidades = document.querySelectorAll('#especialidades-list li');

//-             especialidades.forEach(especialidad => {
//-                 const nombre = especialidad.getAttribute('data-nombre');
//-                 if (nombre.includes(searchInput)) {
//-                     especialidad.style.display = '';
//-                 } else {
//-                     especialidad.style.display = 'none';
//-                 }
//-             });
//-         }








//- extends ../layout

//- block contenido
//-     style.
//-         body {
//-             background-color: #eef5ff;
//-             font-family: Arial, sans-serif;
//-         }
//-         .center-text {
//-             text-align: center;
//-             margin-bottom: 20px;
//-             font-size: 28px;
//-             font-weight: bold;
//-         }
//-         .page-container {
//-             padding: 20px;
//-         }
//-         .top-actions {
//-             display: flex;
//-             justify-content: space-between;
//-             align-items: center;
//-             margin-bottom: 20px;
//-         }
//-         .search-box {
//-             margin-bottom: 15px;
//-         }
//-         .list-group-item {
//-             display: flex;
//-             justify-content: space-between;
//-             align-items: center;
//-             border-radius: 8px;
//-             margin-bottom: 10px;
//-         }
//-         .especialidad-nombre {
//-             font-size: 18px;
//-             font-weight: 500;
//-         }
//-         .button-group {
//-             display: flex;
//-             gap: 8px;
//-         }

//-     .page-container

//-         // ---------- BOTÓN VOLVER ----------
//-         a.btn.btn-outline-dark.mb-3(href="/medicos")
//-             i.fa-solid.fa-arrow-left
//-             |  Volver a Médicos

//-         // ---------- TÍTULO ----------
//-         h3.center-text Especialidades

//-         // ---------- MENSAJE ----------
//-         if successMessage
//-             script.
//-                 Swal.fire({
//-                     title: 'Éxito',
//-                     text: '#{successMessage}',
//-                     icon: 'success',
//-                     confirmButtonText: 'OK'
//-                 });

//-         // ---------- ACCIONES SUPERIORES ----------
//-         .top-actions
//-             a.btn.btn-primary(href="/especialidades/create")
//-                 i.fa-solid.fa-plus
//-                 |  Nueva Especialidad

//-         // ---------- BUSCADOR ----------
//-         .search-box
//-             input#search.form-control(
//-                 type="text"
//-                 placeholder="Buscar especialidad..."
//-                 onkeyup="filterEspecialidades()"
//-             )

//-         // ---------- LISTA ----------
//-         ul.list-group#especialidades-list
//-             each especialidad in especialidades
//-                 li.list-group-item(data-nombre=especialidad.nombre.toLowerCase())
//-                     .flex-grow-1
//-                         span.especialidad-nombre= especialidad.nombre

//-                         // ---------- FORM EDIT ----------
//-                         form.edit-form(
//-                             action=`/especialidades/update/${especialidad.id}`
//-                             method="post"
//-                             style="display:none; margin-top:10px;"
//-                         )
//-                             input.form-control.mb-2(
//-                                 type="text"
//-                                 name="nombre"
//-                                 value=especialidad.nombre
//-                                 required
//-                             )
//-                             button.btn.btn-success.btn-sm(type="submit")
//-                                 i.fa-solid.fa-save
//-                                 |  Guardar

//-                     // ---------- BOTONES ----------
//-                     .button-group
//-                         button.btn.btn-sm.btn-primary(
//-                             type="button"
//-                             onclick=`toggleEditForm(${especialidad.id})`
//-                         )
//-                             i.fa-solid.fa-pen
//-                             |  Editar

//-                         if especialidad.estado == 1
//-                             form(
//-                                 action=`/especialidades/inactivar/${especialidad.id}`
//-                                 method="post"
//-                             )
//-                                 button.btn.btn-sm.btn-danger(type="submit")
//-                                     i.fa-solid.fa-ban
//-                                     |  Inactivar
//-                         else
//-                             form(
//-                                 action=`/especialidades/activar/${especialidad.id}`
//-                                 method="post"
//-                             )
//-                                 button.btn.btn-sm.btn-success(type="submit")
//-                                     i.fa-solid.fa-check
//-                                     |  Activar

//-     // ---------- SCRIPTS ----------
//-     script.
//-         let activeEditForm = null;

//-         function toggleEditForm(id) {
//-             const editForm = document.querySelector(
//-                 `form.edit-form[action='/especialidades/update/${id}']`
//-             );
//-             const nombreSpan = editForm.previousElementSibling;

//-             if (activeEditForm && activeEditForm !== editForm) {
//-                 activeEditForm.style.display = 'none';
//-                 activeEditForm.previousElementSibling.style.display = 'block';
//-             }

//-             if (editForm.style.display === 'none') {
//-                 editForm.style.display = 'block';
//-                 nombreSpan.style.display = 'none';
//-                 activeEditForm = editForm;
//-             } else {
//-                 editForm.style.display = 'none';
//-                 nombreSpan.style.display = 'block';
//-                 activeEditForm = null;
//-             }
//-         }

//-         function filterEspecialidades() {
//-             const searchInput = document
//-                 .getElementById('search')
//-                 .value
//-                 .toLowerCase();

//-             document
//-                 .querySelectorAll('#especialidades-list li')
//-                 .forEach(item => {
//-                     const nombre = item.dataset.nombre;
//-                     item.style.display = nombre.includes(searchInput)
//-                         ? ''
//-                         : 'none';
//-                 });
//-         }


//- extends ../layout

//- block contenido
//-   .container-fluid
//-     // ---------- ENCABEZADO ----------
//-     .row.mb-4
//-       .col-12.d-flex.justify-content-between.align-items-center
//-         div
//-           a.text-decoration-none.small.text-muted(href="/medicos")
//-             i.fa-solid.fa-arrow-left.me-1
//-             | Volver a Médicos
//-           h2.fw-bold.text-primary.mt-1
//-             i.fa-solid.fa-stethoscope.me-2
//-             | Especialidades Médicas
//-           if especialidades
//-             span.badge.bg-light.text-dark.border 
//-               i.bi.bi-tag.me-1
//-               | #{especialidades.length} categorías configuradas
        
//-         a.btn.btn-primary.shadow-sm(href="/especialidades/create")
//-           i.fa-solid.fa-plus.me-2
//-           | Nueva Especialidad

//-     // ---------- BUSCADOR INTERACTIVO ----------
//-     .card.border-0.shadow-sm.mb-4
//-       .card-body
//-         .input-group
//-           span.input-group-text.bg-white.border-end-0
//-             i.fa-solid.fa-magnifying-glass.text-muted
//-           input#search.form-control.border-start-0.ps-0(
//-             type="text" 
//-             placeholder="Filtrar especialidades por nombre..." 
//-             onkeyup="filterEspecialidades()"
//-           )

//-     // ---------- NOTIFICACIÓN SWEETALERT ----------
//-     if successMessage
//-       script.
//-         Swal.fire({
//-           title: '¡Logrado!',
//-           text: '#{successMessage}',
//-           icon: 'success',
//-           confirmButtonColor: '#0a3d62'
//-         });

//-     // ---------- TABLA DE ESPECIALIDADES ----------
//-     .card.border-0.shadow-sm
//-       .table-responsive
//-         table.table.table-hover.align-middle.mb-0
//-           thead.bg-light
//-             tr
//-               th.ps-4(style="width: 60%") Nombre de la Especialidad
//-               th.text-center Estado
//-               th.text-end.pe-4 Acciones

//-           tbody#especialidades-list
//-             if especialidades && especialidades.length > 0
//-               each especialidad in especialidades
//-                 tr(data-nombre=especialidad.nombre.toLowerCase())
//-                   // Columna Nombre / Formulario de Edición
//-                   td.ps-4
//-                     span.especialidad-nombre.fw-bold= especialidad.nombre
                    
//-                     form.edit-form(
//-                       action=`/especialidades/update/${especialidad.id}`
//-                       method="POST"
//-                       style="display:none;"
//-                     )
//-                       .input-group.input-group-sm
//-                         input.form-control(
//-                           type="text"
//-                           name="nombre"
//-                           value=especialidad.nombre
//-                           required
//-                         )
//-                         button.btn.btn-success(type="submit")
//-                           i.fa-solid.fa-check
//-                         button.btn.btn-outline-secondary(type="button" onclick=`toggleEditForm(${especialidad.id})`)
//-                           i.fa-solid.fa-xmark

//-                   // Columna Estado (Corregida con == para evitar errores de tipo)
//-                   td.text-center
//-                     if especialidad.estado == 1 || especialidad.estado == true
//-                       span.badge.rounded-pill.bg-success Activa
//-                     else
//-                       span.badge.rounded-pill.bg-danger Inactiva

//-                   // Columna Acciones
//-                   td.text-end.pe-4
//-                     .btn-group.btn-group-sm
//-                       button.btn.btn-outline-primary(
//-                         type="button" 
//-                         title="Editar nombre"
//-                         onclick=`toggleEditForm(${especialidad.id})`
//-                       )
//-                         i.fa-solid.fa-pen
                      
//-                       if especialidad.estado == 1 || especialidad.estado == true
//-                         form(action=`/especialidades/inactivar/${especialidad.id}` method="POST" style="display:inline;")
//-                           button.btn.btn-outline-danger(type="submit" title="Desactivar")
//-                             i.fa-solid.fa-ban
//-                       else
//-                         form(action=`/especialidades/activar/${especialidad.id}` method="POST" style="display:inline;")
//-                           button.btn.btn-outline-success(type="submit" title="Activar")
//-                             i.fa-solid.fa-check-circle
//-             else
//-               tr
//-                 td.text-center.py-5(colspan="3")
//-                   p.text-muted No hay especialidades registradas.

//-   // ---------- SCRIPTS DE INTERACTIVIDAD ----------
//-   script.
//-     function toggleEditForm(id) {
//-       const row = document.querySelector(`form[action*='/update/${id}']`).closest('tr');
//-       const span = row.querySelector('.especialidad-nombre');
//-       const form = row.querySelector('.edit-form');

//-       if (form.style.display === 'none') {
//-         // Cerrar otros formularios abiertos para evitar desorden
//-         document.querySelectorAll('.edit-form').forEach(f => f.style.display = 'none');
//-         document.querySelectorAll('.especialidad-nombre').forEach(s => s.style.display = 'block');
        
//-         form.style.display = 'flex';
//-         span.style.display = 'none';
//-       } else {
//-         form.style.display = 'none';
//-         span.style.display = 'block';
//-       }
//-     }

//-     function filterEspecialidades() {
//-       const q = document.getElementById('search').value.toLowerCase();
//-       document.querySelectorAll('#especialidades-list tr').forEach(tr => {
//-         const nombre = tr.dataset.nombre || "";
//-         tr.style.display = nombre.includes(q) ? '' : 'none';
//-       });
//-     }

extends ../layout

block contenido
  .container-fluid
    // ---------- ENCABEZADO ----------
    .row.mb-4
      .col-12.d-flex.justify-content-between.align-items-center
        div
          a.text-decoration-none.small.text-muted(href="/medicos")
            i.fa-solid.fa-arrow-left.me-1
            | Volver a Médicos
          h2.fw-bold.text-primary.mt-1
            i.fa-solid.fa-stethoscope.me-2
            | Especialidades Médicas
          if especialidades
            span.badge.bg-light.text-dark.border 
              i.bi.bi-tag.me-1
              | #{especialidades.length} registros encontrados
        
        a.btn.btn-primary.shadow-sm(href="/especialidades/create")
          i.fa-solid.fa-plus.me-2
          | Nueva Especialidad

    // ---------- BUSCADOR ----------
    .card.border-0.shadow-sm.mb-4
      .card-body
        .input-group
          span.input-group-text.bg-white.border-end-0
            i.fa-solid.fa-magnifying-glass.text-muted
          input#search.form-control.border-start-0.ps-0(
            type="text" 
            placeholder="Filtrar especialidades..." 
            onkeyup="filterEspecialidades()"
          )

    if successMessage
      script.
        Swal.fire({ title: '¡Hecho!', text: '#{successMessage}', icon: 'success', confirmButtonColor: '#0a3d62' });

    // ---------- TABLA ----------
    .card.border-0.shadow-sm
      .table-responsive
        table.table.table-hover.align-middle.mb-0
          thead.bg-light
            tr
              th.ps-4(style="width: 60%") Nombre
              th.text-center Estado
              th.text-end.pe-4 Acciones

          tbody#especialidades-list
            if especialidades && especialidades.length > 0
              each esp in especialidades
                //- Definimos la variable de estado buscando posibles nombres (estado o activo)
                - const esActivo = (esp.estado == 1 || esp.activo == 1 || esp.estado == true)
                
                tr(data-nombre=esp.nombre.toLowerCase())
                  td.ps-4
                    span.especialidad-nombre.fw-bold= esp.nombre
                    
                    form.edit-form(action=`/especialidades/update/${esp.id}` method="POST" style="display:none;")
                      .input-group.input-group-sm
                        input.form-control(type="text" name="nombre" value=esp.nombre required)
                        button.btn.btn-success(type="submit"): i.fa-solid.fa-check
                        button.btn.btn-outline-secondary(type="button" onclick=`toggleEditForm(${esp.id})`): i.fa-solid.fa-xmark

                  td.text-center
                    if esActivo
                      span.badge.rounded-pill.bg-success Activa
                    else
                      span.badge.rounded-pill.bg-danger Inactiva

                  td.text-end.pe-4
                    .btn-group.btn-group-sm
                      button.btn.btn-outline-primary(type="button" onclick=`toggleEditForm(${esp.id})` title="Editar")
                        i.fa-solid.fa-pen
                      
                      if esActivo
                        form(action=`/especialidades/inactivar/${esp.id}` method="POST" style="display:inline;")
                          button.btn.btn-outline-danger(type="submit" title="Desactivar")
                            i.fa-solid.fa-ban
                      else
                        form(action=`/especialidades/activar/${esp.id}` method="POST" style="display:inline;")
                          button.btn.btn-outline-success(type="submit" title="Activar")
                            i.fa-solid.fa-check-circle
            else
              tr
                td.text-center.py-5(colspan="3") No hay especialidades.

  script.
    function toggleEditForm(id) {
      const row = document.querySelector(`form[action*='/update/${id}']`).closest('tr');
      const span = row.querySelector('.especialidad-nombre');
      const form = row.querySelector('.edit-form');
      if (form.style.display === 'none') {
        document.querySelectorAll('.edit-form').forEach(f => f.style.display = 'none');
        document.querySelectorAll('.especialidad-nombre').forEach(s => s.style.display = 'block');
        form.style.display = 'flex';
        span.style.display = 'none';
      } else {
        form.style.display = 'none';
        span.style.display = 'block';
      }
    }

    function filterEspecialidades() {
      const q = document.getElementById('search').value.toLowerCase();
      document.querySelectorAll('#especialidades-list tr').forEach(tr => {
        const nombre = tr.dataset.nombre || "";
        tr.style.display = nombre.includes(q) ? '' : 'none';
      });
    }