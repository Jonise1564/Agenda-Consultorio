//- extends ../layout

//- block contenido
//-     style.
//-         body {
//-             background-color: #eef5ff;
//-             font-family: Arial, sans-serif;
//-         }
//-         .center-text {
//-             text-align: center;
//-             margin-bottom: 20px;
//-             font-size: 28px;
//-             font-weight: bold;
//-         }
//-         .page-container {
//-             padding: 20px;
//-         }
//-         .top-actions {
//-             display: flex;
//-             justify-content: space-between;
//-             align-items: center;
//-             margin-bottom: 20px;
//-         }
//-         .list-group-item {
//-             display: flex;
//-             justify-content: space-between;
//-             align-items: flex-start;
//-             border-radius: 8px;
//-             margin-bottom: 10px;
//-         }
//-         .obraSocial-nombre {
//-             font-size: 18px;
//-             font-weight: 500;
//-         }
//-         .obraSocial-detalle {
//-             font-size: 14px;
//-             color: #555;
//-         }
//-         .button-group {
//-             display: flex;
//-             gap: 8px;
//-         }

//-     .page-container

//-         // ---------- BOTÓN VOLVER ----------
//-         a.btn.btn-outline-dark.mb-3(href="/pacientes")
//-             i.fa-solid.fa-arrow-left
//-             |  Volver a Pacientes

//-         // ---------- TÍTULO ----------
//-         h3.center-text Obras Sociales

//-         // ---------- MENSAJE ----------
//-         if successMessage
//-             script.
//-                 Swal.fire({
//-                     title: 'Éxito',
//-                     text: '#{successMessage}',
//-                     icon: 'success',
//-                     confirmButtonText: 'OK'
//-                 });

//-         // ---------- ACCIONES SUPERIORES ----------
//-         .top-actions
//-             a.btn.btn-primary(href="/obrasSociales/create")
//-                 i.fa-solid.fa-plus
//-                 |  Nueva Obra Social

//-         // ---------- LISTA ----------
//-         ul.list-group
//-             each obraSocial in obrasSociales
//-                 li.list-group-item
//-                     .flex-grow-1
//-                         span.obraSocial-nombre= obraSocial.nombre
//-                         br
//-                         span.obraSocial-detalle= obraSocial.descripcion
//-                         br
//-                         span.obraSocial-detalle Dirección: #{obraSocial.direccion}

//-                         // ---------- FORM EDIT ----------
//-                         form.edit-form(
//-                             action=`/obrasSociales/update/${obraSocial.id}`
//-                             method="post"
//-                             style="display:none; margin-top:10px;"
//-                         )
//-                             input.form-control.mb-2(
//-                                 type="text"
//-                                 name="nombre"
//-                                 value=obraSocial.nombre
//-                                 required
//-                             )
//-                             textarea.form-control.mb-2(
//-                                 name="descripcion"
//-                                 rows="3"
//-                                 required
//-                             )= obraSocial.descripcion
//-                             input.form-control.mb-2(
//-                                 type="text"
//-                                 name="direccion"
//-                                 value=obraSocial.direccion
//-                                 required
//-                             )
//-                             button.btn.btn-success.btn-sm(type="submit")
//-                                 i.fa-solid.fa-save
//-                                 |  Guardar

//-                     // ---------- BOTONES ----------
//-                     .button-group
//-                         button.btn.btn-sm.btn-primary(
//-                             type="button"
//-                             onclick=`toggleEditForm(${obraSocial.id})`
//-                         )
//-                             i.fa-solid.fa-pen
//-                             |  Editar

//-                         if obraSocial.estado == 1
//-                             form(action=`/obrasSociales/inactivar/${obraSocial.id}` method="post")
//-                                 button.btn.btn-sm.btn-danger(type="submit")
//-                                     i.fa-solid.fa-ban
//-                                     |  Inactivar
//-                         else
//-                             form(action=`/obrasSociales/activar/${obraSocial.id}` method="post")
//-                                 button.btn.btn-sm.btn-success(type="submit")
//-                                     i.fa-solid.fa-check
//-                                     |  Activar

//-     // ---------- SCRIPTS ----------
//-     script.
//-         let activeEditForm = null;

//-         function toggleEditForm(id) {
//-             const editForm = document.querySelector(
//-                 `form.edit-form[action='/obrasSociales/update/${id}']`
//-             );
//-             const nombreSpan = editForm.previousElementSibling;

//-             if (activeEditForm && activeEditForm !== editForm) {
//-                 activeEditForm.style.display = 'none';
//-                 activeEditForm.previousElementSibling.style.display = 'block';
//-             }

//-             if (editForm.style.display === 'none') {
//-                 editForm.style.display = 'block';
//-                 nombreSpan.style.display = 'none';
//-                 activeEditForm = editForm;
//-             } else {
//-                 editForm.style.display = 'none';
//-                 nombreSpan.style.display = 'block';
//-                 activeEditForm = null;
//-             }
//-         }


extends ../layout

block contenido
  .container.mt-4.mb-5
    // ---------- ENCABEZADO ----------
    .row.mb-4
      .col-12.d-flex.justify-content-between.align-items-center
        div
          h2.fw-bold.text-primary 
            i.bi.bi-hospital.me-2
            | Obras Sociales
          p.text-muted Administre las coberturas médicas aceptadas en el consultorio.
        a.btn.btn-outline-secondary.btn-sm.shadow-sm(href="/pacientes")
          i.bi.bi-arrow-left.me-1
          | Volver a Pacientes

    // ---------- ALERTAS ----------
    if successMessage
      script.
        Swal.fire({
          title: '¡Completado!',
          text: '#{successMessage}',
          icon: 'success',
          confirmButtonColor: '#0d6efd'
        });

    // ---------- ACCIONES SUPERIORES ----------
    .row.mb-3
      .col-12.d-flex.justify-content-end
        a.btn.btn-primary.shadow-sm(href="/obrasSociales/create")
          i.bi.bi-plus-lg.me-1
          | Nueva Obra Social

    // ---------- LISTADO ----------
    .row
      .col-12
        .card.border-0.shadow-sm
          .card-body.p-0
            .table-responsive
              table.table.table-hover.align-middle.mb-0
                thead.bg-light
                  tr
                    th.ps-4 Nombre y Detalles
                    th.text-center Estado
                    th.text-end.pe-4 Acciones
                tbody
                  each obraSocial in obrasSociales
                    tr(class=obraSocial.estado == 0 ? 'opacity-50' : '')
                      td.ps-4
                        //- Vista normal
                        .view-mode(id=`view-${obraSocial.id}`)
                          .fw-bold.text-dark.fs-5= obraSocial.nombre
                          .text-muted.small= obraSocial.descripcion
                          .text-muted.small
                            i.bi.bi-geo-alt.me-1
                            | #{obraSocial.direccion}
                        
                        //- Formulario de edición rápida (oculto por defecto)
                        .edit-mode(id=`edit-${obraSocial.id}` style="display:none;")
                          form.row.g-2(action=`/obrasSociales/update/${obraSocial.id}` method="post")
                            .col-md-4
                              input.form-control.form-control-sm(type="text" name="nombre" value=obraSocial.nombre required)
                            .col-md-4
                              input.form-control.form-control-sm(type="text" name="direccion" value=obraSocial.direccion required)
                            .col-md-4
                              textarea.form-control.form-control-sm(name="descripcion" rows="1" required)= obraSocial.descripcion
                            .col-12.mt-2
                              button.btn.btn-success.btn-sm.me-2(type="submit")
                                i.bi.bi-check-lg.me-1
                                | Guardar
                              button.btn.btn-light.btn-sm(type="button" onclick=`toggleEdit(${obraSocial.id})`) Cancelar

                      td.text-center
                        if obraSocial.estado == 1
                          span.badge.rounded-pill.bg-success-subtle.text-success.border.border-success Activa
                        else
                          span.badge.rounded-pill.bg-danger-subtle.text-danger.border.border-danger Inactiva

                      td.text-end.pe-4
                        .btn-group.shadow-sm
                          button.btn.btn-outline-primary.btn-sm(type="button" title="Editar" onclick=`toggleEdit(${obraSocial.id})`)
                            i.bi.bi-pencil-square
                          
                          if obraSocial.estado == 1
                            form(action=`/obrasSociales/inactivar/${obraSocial.id}` method="post" style="display:inline;")
                              button.btn.btn-outline-danger.btn-sm(type="submit" title="Inactivar")
                                i.bi.bi-slash-circle
                          else
                            form(action=`/obrasSociales/activar/${obraSocial.id}` method="post" style="display:inline;")
                              button.btn.btn-outline-success.btn-sm(type="submit" title="Activar")
                                i.bi.bi-check-circle

  script.
    function toggleEdit(id) {
      const viewMode = document.getElementById(`view-${id}`);
      const editMode = document.getElementById(`edit-${id}`);
      
      if (editMode.style.display === 'none') {
        // Cerrar otros que puedan estar abiertos
        document.querySelectorAll('.edit-mode').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.view-mode').forEach(el => el.style.display = 'block');
        
        editMode.style.display = 'block';
        viewMode.style.display = 'none';
      } else {
        editMode.style.display = 'none';
        viewMode.style.display = 'block';
      }
    }