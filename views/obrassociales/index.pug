extends ../layout

block contenido
    style.
        body {
            background-color: #eef5ff;
            font-family: Arial, sans-serif;
        }
        .center-text {
            text-align: center;
            margin-bottom: 20px;
            font-size: 28px;
            font-weight: bold;
        }
        .page-container {
            padding: 20px;
        }
        .top-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .list-group-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .obraSocial-nombre {
            font-size: 18px;
            font-weight: 500;
        }
        .obraSocial-detalle {
            font-size: 14px;
            color: #555;
        }
        .button-group {
            display: flex;
            gap: 8px;
        }

    .page-container

        // ---------- BOTÓN VOLVER ----------
        a.btn.btn-outline-dark.mb-3(href="/pacientes")
            i.fa-solid.fa-arrow-left
            |  Volver a Pacientes

        // ---------- TÍTULO ----------
        h3.center-text Obras Sociales

        // ---------- MENSAJE ----------
        if successMessage
            script.
                Swal.fire({
                    title: 'Éxito',
                    text: '#{successMessage}',
                    icon: 'success',
                    confirmButtonText: 'OK'
                });

        // ---------- ACCIONES SUPERIORES ----------
        .top-actions
            a.btn.btn-primary(href="/obrasSociales/create")
                i.fa-solid.fa-plus
                |  Nueva Obra Social

        // ---------- LISTA ----------
        ul.list-group
            each obraSocial in obrasSociales
                li.list-group-item
                    .flex-grow-1
                        span.obraSocial-nombre= obraSocial.nombre
                        br
                        span.obraSocial-detalle= obraSocial.descripcion
                        br
                        span.obraSocial-detalle Dirección: #{obraSocial.direccion}

                        // ---------- FORM EDIT ----------
                        form.edit-form(
                            action=`/obrasSociales/update/${obraSocial.id}`
                            method="post"
                            style="display:none; margin-top:10px;"
                        )
                            input.form-control.mb-2(
                                type="text"
                                name="nombre"
                                value=obraSocial.nombre
                                required
                            )
                            textarea.form-control.mb-2(
                                name="descripcion"
                                rows="3"
                                required
                            )= obraSocial.descripcion
                            input.form-control.mb-2(
                                type="text"
                                name="direccion"
                                value=obraSocial.direccion
                                required
                            )
                            button.btn.btn-success.btn-sm(type="submit")
                                i.fa-solid.fa-save
                                |  Guardar

                    // ---------- BOTONES ----------
                    .button-group
                        button.btn.btn-sm.btn-primary(
                            type="button"
                            onclick=`toggleEditForm(${obraSocial.id})`
                        )
                            i.fa-solid.fa-pen
                            |  Editar

                        if obraSocial.estado == 1
                            form(action=`/obrasSociales/inactivar/${obraSocial.id}` method="post")
                                button.btn.btn-sm.btn-danger(type="submit")
                                    i.fa-solid.fa-ban
                                    |  Inactivar
                        else
                            form(action=`/obrasSociales/activar/${obraSocial.id}` method="post")
                                button.btn.btn-sm.btn-success(type="submit")
                                    i.fa-solid.fa-check
                                    |  Activar

    // ---------- SCRIPTS ----------
    script.
        let activeEditForm = null;

        function toggleEditForm(id) {
            const editForm = document.querySelector(
                `form.edit-form[action='/obrasSociales/update/${id}']`
            );
            const nombreSpan = editForm.previousElementSibling;

            if (activeEditForm && activeEditForm !== editForm) {
                activeEditForm.style.display = 'none';
                activeEditForm.previousElementSibling.style.display = 'block';
            }

            if (editForm.style.display === 'none') {
                editForm.style.display = 'block';
                nombreSpan.style.display = 'none';
                activeEditForm = editForm;
            } else {
                editForm.style.display = 'none';
                nombreSpan.style.display = 'block';
                activeEditForm = null;
            }
        }
