//- extends ../layout

//- block contenido
//-   a.btn.btn-outline-dark.mb-3(href="/medicos") ← Volver

//-   h2.text-center Editar Médico

//-   // ======================
//-   // ESTADO
//-   // ======================
//-   hr
//-   h5.text-center Estado del Profesional
//-   p.text-center(class= medico.estado == 1 ? 'text-success' : 'text-danger')
//-     | #{medico.estado == 1 ? 'Activo' : 'Inactivo'}

//-   .mb-3.text-center
//-     if medico.estado == 1
//-       form(method="POST" action=`/medicos/inactivar/${medico.id_medico}`)
//-         button.btn.btn-danger(type="submit") Inactivar
//-     else
//-       form(method="POST" action=`/medicos/activar/${medico.id_medico}`)
//-         button.btn.btn-success(type="submit") Activar

//-   // ======================
//-   // FORMULARIO
//-   // ======================
//-   hr
//-   form(
//-     action=`/medicos/update/${medico.id_medico}`
//-     method="POST"
//-     novalidate
//-   )
//-     input(type="hidden" name="id_persona" value=persona.id)
//-     input(type="hidden" name="id_usuario" value=usuario.id)

//-     .row
//-       .col-md-6.mb-3
//-         label.form-label Nombre
//-         input.form-control(type="text" name="nombre" value=persona.nombre required)

//-       .col-md-6.mb-3
//-         label.form-label Apellido
//-         input.form-control(type="text" name="apellido" value=persona.apellido required)

//-       .col-md-6.mb-3
//-         label.form-label Fecha de nacimiento
//-         input.form-control(
//-           type="date"
//-           name="nacimiento"
//-           value=persona.nacimiento
//-             ? persona.nacimiento.toISOString().split('T')[0]
//-             : ''
//-           required
//-         )

//-       .col-md-6.mb-3
//-         label.form-label Email
//-         input.form-control(type="email" name="email" value=usuario.email required)

//-       .col-md-6.mb-3
//-         label.form-label Nueva contraseña
//-         input.form-control(type="password" name="password" placeholder="Opcional")

//-       .col-md-6.mb-3
//-         label.form-label Matrícula profesional
//-         input.form-control(
//-           type="text"
//-           name="matricula"
//-           value=medico.matricula
//-           required
//-         )

//-     // ======================
//-     // TELÉFONOS
//-     // ======================
//-     hr
//-     h5 Teléfonos

//-     #telefonos-container
//-       each tel in (medico.telefonos || '').split(', ')
//-         if tel
//-           .input-group.mb-2
//-             input.form-control(
//-               type="text"
//-               name="telefonos[]"
//-               value=tel
//-             )
//-             button.btn.btn-outline-danger(
//-               type="button"
//-               onclick="this.parentElement.remove()"
//-             ) ✕

//-     button.btn.btn-outline-primary.btn-sm(
//-       type="button"
//-       onclick="agregarTelefono()"
//-     ) + Agregar teléfono

//-     // ======================
//-     // ESPECIALIDADES
//-     // ======================
//-     hr
//-     h5 Especialidades

//-     #especialidades-container
//-       each esp in especialidadesAsignadas
//-         .input-group.mb-2
//-           input.form-control(type="text" readonly value=esp.nombre)
//-           input(type="hidden" name="especialidades[]" value=esp.id_especialidad)
//-           button.btn.btn-outline-danger(
//-             type="button"
//-             onclick="this.parentElement.remove()"
//-           ) ✕

//-     select.form-select.mt-2#select-especialidad
//-       option(value="") + Agregar especialidad
//-       each esp in especialidades
//-         option(value=esp.id data-nombre=esp.nombre)= esp.nombre

//-     button.btn.btn-outline-primary.mt-2(
//-       type="button"
//-       onclick="agregarEspecialidad()"
//-     ) Agregar especialidad

//-     // ======================
//-     // GUARDAR
//-     // ======================
//-     .mt-4.text-end
//-       button.btn.btn-success(type="submit") Guardar cambios

//-   // ======================
//-   // SCRIPTS
//-   // ======================
//-   script.
//-     function agregarTelefono() {
//-       const cont = document.getElementById('telefonos-container');
//-       const div = document.createElement('div');
//-       div.className = 'input-group mb-2';
//-       div.innerHTML = `
//-         <input class="form-control" type="text" name="telefonos[]" />
//-         <button class="btn btn-outline-danger" type="button" onclick="this.parentElement.remove()">✕</button>
//-       `;
//-       cont.appendChild(div);
//-     }

//-     function agregarEspecialidad() {
//-       const select = document.getElementById('select-especialidad');
//-       const id = select.value;
//-       if (!id) return;

//-       const nombre = select.options[select.selectedIndex].dataset.nombre;
//-       const cont = document.getElementById('especialidades-container');

//-       // Evitar duplicados
//-       if ([...cont.querySelectorAll('input[type="hidden"]')]
//-           .some(i => i.value === id)) return;

//-       const div = document.createElement('div');
//-       div.className = 'input-group mb-2';
//-       div.innerHTML = `
//-         <input class="form-control" readonly value="${nombre}" />
//-         <input type="hidden" name="especialidades[]" value="${id}" />
//-         <button class="btn btn-outline-danger" type="button" onclick="this.parentElement.remove()">✕</button>
//-       `;

//-       cont.appendChild(div);
//-       select.value = '';
//-     }


//- extends ../layout

//- block contenido
//-   a.btn.btn-outline-dark.mb-3(href="/medicos") ← Volver a Medicos

//-   h2.text-center Editar Médico

//-   // ======================
//-   // ESTADO
//-   // ======================
//-   hr
//-   h5.text-center Estado del Profesional
//-   p.text-center(class= medico.estado == 1 ? 'text-success' : 'text-danger')
//-     | #{medico.estado == 1 ? 'Activo' : 'Inactivo'}

//-   .mb-3.text-center
//-     if medico.estado == 1
//-       form(method="POST" action=`/medicos/inactivar/${medico.id_medico}`)
//-         button.btn.btn-danger(type="submit") Inactivar
//-     else
//-       form(method="POST" action=`/medicos/activar/${medico.id_medico}`)
//-         button.btn.btn-success(type="submit") Activar

//-   // ======================
//-   // FORMULARIO
//-   // ======================
//-   hr
//-   form(
//-     action=`/medicos/update/${medico.id_medico}`
//-     method="POST"
//-     novalidate
//-   )
//-     // IDs ocultos
//-     input(type="hidden" name="id_persona" value=persona.id)
//-     input(type="hidden" name="id_usuario" value=usuario.id)

//-     // FLAG DE CONTROL (CLAVE)
//-     input(
//-       type="hidden"
//-       name="especialidades_modificadas"
//-       value="0"
//-       id="esp-mod"
//-     )

//-     .row
//-       .col-md-6.mb-3
//-         label.form-label Nombre
//-         input.form-control(type="text" name="nombre" value=persona.nombre required)

//-       .col-md-6.mb-3
//-         label.form-label Apellido
//-         input.form-control(type="text" name="apellido" value=persona.apellido required)

//-       .col-md-6.mb-3
//-         label.form-label Fecha de nacimiento
//-         input.form-control(
//-           type="date"
//-           name="nacimiento"
//-           value=persona.nacimiento
//-             ? persona.nacimiento.toISOString().split('T')[0]
//-             : ''
//-           required
//-         )

//-       .col-md-6.mb-3
//-         label.form-label Email
//-         input.form-control(type="email" name="email" value=usuario.email required)

//-       .col-md-6.mb-3
//-         label.form-label Nueva contraseña
//-         input.form-control(type="password" name="password" placeholder="Opcional")

//-       .col-md-6.mb-3
//-         label.form-label Matrícula profesional
//-         input.form-control(
//-           type="text"
//-           name="matricula"
//-           value=medico.matricula
//-           required
//-         )

//-     // ======================
//-     // TELÉFONOS
//-     // ======================
//-     hr
//-     h5 Teléfonos

//-     #telefonos-container
//-       each tel in (medico.telefonos || '').split(', ')
//-         if tel
//-           .input-group.mb-2
//-             input.form-control(
//-               type="text"
//-               name="telefonos[]"
//-               value=tel
//-             )
//-             button.btn.btn-outline-danger(
//-               type="button"
//-               onclick="this.parentElement.remove()"
//-             ) ✕

//-     button.btn.btn-outline-primary.btn-sm(
//-       type="button"
//-       onclick="agregarTelefono()"
//-     ) + Agregar teléfono

//-     // ======================
//-     // ESPECIALIDADES
//-     // ======================
//-     hr
//-     h5 Especialidades

//-     #especialidades-container
//-       each esp in especialidadesAsignadas
//-         .input-group.mb-2
//-           input.form-control(type="text" readonly value=esp.nombre)
//-           input(type="hidden" name="especialidades[]" value=esp.id_especialidad)
//-           button.btn.btn-outline-danger(
//-             type="button"
//-             onclick="marcarEspecialidadesModificadas(); this.parentElement.remove()"
//-           ) ✕

//-     select.form-select.mt-2#select-especialidad
//-       option(value="") + Agregar especialidad
//-       each esp in especialidades
//-         option(value=esp.id data-nombre=esp.nombre)= esp.nombre

//-     button.btn.btn-outline-primary.mt-2(
//-       type="button"
//-       onclick="agregarEspecialidad()"
//-     ) Agregar especialidad

//-     // ======================
//-     // GUARDAR
//-     // ======================
//-     .mt-4.text-end
//-       button.btn.btn-success(type="submit") Guardar cambios

//-   // ======================
//-   // SCRIPTS
//-   // ======================
//-   script.
//-     function marcarEspecialidadesModificadas() {
//-       document.getElementById('esp-mod').value = '1';
//-     }

//-     function agregarTelefono() {
//-       const cont = document.getElementById('telefonos-container');
//-       const div = document.createElement('div');
//-       div.className = 'input-group mb-2';
//-       div.innerHTML = `
//-         <input class="form-control" type="text" name="telefonos[]" />
//-         <button class="btn btn-outline-danger" type="button" onclick="this.parentElement.remove()">✕</button>
//-       `;
//-       cont.appendChild(div);
//-     }

//-     function agregarEspecialidad() {
//-       const select = document.getElementById('select-especialidad');
//-       const id = select.value;
//-       if (!id) return;

//-       marcarEspecialidadesModificadas();

//-       const nombre = select.options[select.selectedIndex].dataset.nombre;
//-       const cont = document.getElementById('especialidades-container');

//-       // Evitar duplicados
//-       if ([...cont.querySelectorAll('input[type="hidden"]')]
//-           .some(i => i.value === id)) return;

//-       const div = document.createElement('div');
//-       div.className = 'input-group mb-2';
//-       div.innerHTML = `
//-         <input class="form-control" readonly value="${nombre}" />
//-         <input type="hidden" name="especialidades[]" value="${id}" />
//-         <button class="btn btn-outline-danger" type="button"
//-           onclick="marcarEspecialidadesModificadas(); this.parentElement.remove()">✕</button>
//-       `;

//-       cont.appendChild(div);
//-       select.value = '';
//-     }


extends ../layout

block contenido
  a.btn.btn-outline-dark.mb-3(href="/medicos") ← Volver a Médicos

  h2.text-center Editar Médico

  // ======================
  // ESTADO
  // ======================
  hr
  h5.text-center Estado del Profesional
  p.text-center(class= medico.estado == 1 ? 'text-success' : 'text-danger')
    | #{medico.estado == 1 ? 'Activo' : 'Inactivo'}

  .mb-3.text-center
    if medico.estado == 1
      form(method="POST" action=`/medicos/inactivar/${medico.id_medico}`)
        button.btn.btn-danger(type="submit") Inactivar
    else
      form(method="POST" action=`/medicos/activar/${medico.id_medico}`)
        button.btn.btn-success(type="submit") Activar

  // ======================
  // FORMULARIO
  // ======================
  hr
  form(
    action=`/medicos/update/${medico.id_medico}`
    method="POST"
    novalidate
  )
    // IDs ocultos
    input(type="hidden" name="id_persona" value=persona.id)
    input(type="hidden" name="id_usuario" value=usuario.id)

    // FLAGS DE CONTROL
    input(type="hidden" name="especialidades_modificadas" value="0" id="esp-mod")
    input(type="hidden" name="telefonos_modificados" value="0" id="tel-mod")

    .row
      .col-md-6.mb-3
        label.form-label Nombre
        input.form-control(type="text" name="nombre" value=persona.nombre required)

      .col-md-6.mb-3
        label.form-label Apellido
        input.form-control(type="text" name="apellido" value=persona.apellido required)

      .col-md-6.mb-3
        label.form-label Fecha de nacimiento
        input.form-control(
          type="date"
          name="nacimiento"
          value=persona.nacimiento
            ? persona.nacimiento.toISOString().split('T')[0]
            : ''
          required
        )

      .col-md-6.mb-3
        label.form-label Email
        input.form-control(type="email" name="email" value=usuario.email required)

      .col-md-6.mb-3
        label.form-label Nueva contraseña
        input.form-control(type="password" name="password" placeholder="Opcional")

      .col-md-6.mb-3
        label.form-label Matrícula profesional
        input.form-control(type="text" name="matricula" value=medico.matricula required)

    // ======================
    // TELÉFONOS
    // ======================
    hr
    h5 Teléfonos

    #telefonos-container
      each tel in (medico.telefonos || '').split(', ')
        if tel
          .input-group.mb-2
            input.form-control(type="text" name="telefonos[]" value=tel)
            button.btn.btn-outline-danger(
              type="button"
              onclick="marcarTelefonosModificados(); this.parentElement.remove()"
            ) ✕

    button.btn.btn-outline-primary.btn-sm(
      type="button"
      onclick="agregarTelefono()"
    ) + Agregar teléfono

    // ======================
    // ESPECIALIDADES
    // ======================
    hr
    h5 Especialidades

    #especialidades-container
      each esp in especialidadesAsignadas
        .input-group.mb-2
          input.form-control(type="text" readonly value=esp.nombre)
          input(type="hidden" name="especialidades[]" value=esp.id_especialidad)
          button.btn.btn-outline-danger(
            type="button"
            onclick="marcarEspecialidadesModificadas(); this.parentElement.remove()"
          ) ✕

    select.form-select.mt-2#select-especialidad
      option(value="") + Agregar especialidad
      each esp in especialidades
        option(value=esp.id data-nombre=esp.nombre)= esp.nombre

    button.btn.btn-outline-primary.mt-2(
      type="button"
      onclick="agregarEspecialidad()"
    ) Agregar especialidad

    // ======================
    // GUARDAR
    // ======================
    .mt-4.text-end
      button.btn.btn-success(type="submit") Guardar cambios

  // ======================
  // SCRIPTS
  // ======================
  script.
    function marcarEspecialidadesModificadas() {
      document.getElementById('esp-mod').value = '1';
    }

    function marcarTelefonosModificados() {
      document.getElementById('tel-mod').value = '1';
    }

    function agregarTelefono() {
      marcarTelefonosModificados();

      const cont = document.getElementById('telefonos-container');
      const div = document.createElement('div');
      div.className = 'input-group mb-2';
      div.innerHTML = `
        <input class="form-control" type="text" name="telefonos[]" />
        <button class="btn btn-outline-danger" type="button"
          onclick="marcarTelefonosModificados(); this.parentElement.remove()">✕</button>
      `;
      cont.appendChild(div);
    }

    function agregarEspecialidad() {
      const select = document.getElementById('select-especialidad');
      const id = select.value;
      if (!id) return;

      marcarEspecialidadesModificadas();

      const nombre = select.options[select.selectedIndex].dataset.nombre;
      const cont = document.getElementById('especialidades-container');

      if ([...cont.querySelectorAll('input[type="hidden"]')]
          .some(i => i.value === id)) return;

      const div = document.createElement('div');
      div.className = 'input-group mb-2';
      div.innerHTML = `
        <input class="form-control" readonly value="${nombre}" />
        <input type="hidden" name="especialidades[]" value="${id}" />
        <button class="btn btn-outline-danger" type="button"
          onclick="marcarEspecialidadesModificadas(); this.parentElement.remove()">✕</button>
      `;

      cont.appendChild(div);
      select.value = '';
    }
