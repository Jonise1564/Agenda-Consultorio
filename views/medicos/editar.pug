//- //- extends ../layout

//- //- block contenido
//- //-   a.btn.btn-outline-dark.mb-3(href="/medicos") ← Volver a Médicos

//- //-   h2.text-center Editar Médico

//- //-   // ======================
//- //-   // ESTADO
//- //-   // ======================
//- //-   hr
//- //-   h5.text-center Estado del Profesional
//- //-   p.text-center(class= medico.estado == 1 ? 'text-success' : 'text-danger')
//- //-     | #{medico.estado == 1 ? 'Activo' : 'Inactivo'}

//- //-   .mb-3.text-center
//- //-     if medico.estado == 1
//- //-       form(method="POST" action=`/medicos/inactivar/${medico.id_medico}`)
//- //-         button.btn.btn-danger(type="submit") Inactivar
//- //-     else
//- //-       form(method="POST" action=`/medicos/activar/${medico.id_medico}`)
//- //-         button.btn.btn-success(type="submit") Activar

//- //-   // ======================
//- //-   // FORMULARIO
//- //-   // ======================
//- //-   hr
//- //-   form(
//- //-     action=`/medicos/update/${medico.id_medico}`
//- //-     method="POST"
//- //-     novalidate
//- //-   )
//- //-     // IDs ocultos
//- //-     input(type="hidden" name="id_persona" value=persona.id)
//- //-     input(type="hidden" name="id_usuario" value=usuario.id)

//- //-     // FLAGS DE CONTROL
//- //-     input(type="hidden" name="especialidades_modificadas" value="0" id="esp-mod")
//- //-     input(type="hidden" name="telefonos_modificados" value="0" id="tel-mod")

//- //-     .row
//- //-       .col-md-6.mb-3
//- //-         label.form-label Nombre
//- //-         input.form-control(type="text" name="nombre" value=persona.nombre required)

//- //-       .col-md-6.mb-3
//- //-         label.form-label Apellido
//- //-         input.form-control(type="text" name="apellido" value=persona.apellido required)

//- //-       .col-md-6.mb-3
//- //-         label.form-label Fecha de nacimiento
//- //-         input.form-control(
//- //-           type="date"
//- //-           name="nacimiento"
//- //-           value=persona.nacimiento
//- //-             ? persona.nacimiento.toISOString().split('T')[0]
//- //-             : ''
//- //-           required
//- //-         )

//- //-       .col-md-6.mb-3
//- //-         label.form-label Email
//- //-         input.form-control(type="email" name="email" value=usuario.email required)

//- //-       .col-md-6.mb-3
//- //-         label.form-label Nueva contraseña
//- //-         input.form-control(type="password" name="password" placeholder="Opcional")

//- //-       .col-md-6.mb-3
//- //-         label.form-label Matrícula profesional
//- //-         input.form-control(type="text" name="matricula" value=medico.matricula required)

//- //-     // ======================
//- //-     // TELÉFONOS
//- //-     // ======================
//- //-     hr
//- //-     h5 Teléfonos

//- //-     #telefonos-container
//- //-       each tel in (medico.telefonos || '').split(', ')
//- //-         if tel
//- //-           .input-group.mb-2
//- //-             input.form-control(
//- //-               type="text"
//- //-               name="telefonos"
//- //-               value=tel
//- //-               oninput="marcarTelefonosModificados()"
//- //-             )
//- //-             button.btn.btn-outline-danger(
//- //-               type="button"
//- //-               onclick="marcarTelefonosModificados(); this.parentElement.remove()"
//- //-             ) ✕ 

//- //-     button.btn.btn-outline-primary.btn-sm(
//- //-       type="button"
//- //-       onclick="agregarTelefono()"
//- //-     ) + Agregar teléfono

//- //-     // ======================
//- //-     // ESPECIALIDADES
//- //-     // ======================
//- //-     hr
//- //-     h5 Especialidades

//- //-     #especialidades-container
//- //-       each esp in especialidadesAsignadas
//- //-         .input-group.mb-2
//- //-           input.form-control(type="text" readonly value=esp.nombre)
//- //-           input(type="hidden" name="especialidades" value=esp.id_especialidad)
//- //-           button.btn.btn-outline-danger(
//- //-             type="button"
//- //-             onclick="marcarEspecialidadesModificadas(); this.parentElement.remove()"
//- //-           ) ✕ 

//- //-     select.form-select.mt-2#select-especialidad
//- //-       option(value="") + Agregar especialidad
//- //-       each esp in especialidades
//- //-         option(value=esp.id data-nombre=esp.nombre)= esp.nombre

//- //-     button.btn.btn-outline-primary.mt-2(
//- //-       type="button"
//- //-       onclick="agregarEspecialidad()"
//- //-     ) Agregar especialidad

//- //-     // ======================
//- //-     // GUARDAR
//- //-     // ======================
//- //-     .mt-4.text-end
//- //-       button.btn.btn-success(type="submit") Guardar cambios

//- //-   // ======================
//- //-   // SCRIPTS
//- //-   // ======================
//- //-   script.
//- //-     // Marcar especialidades como modificadas
//- //-     function marcarEspecialidadesModificadas() {
//- //-       document.getElementById('esp-mod').value = '1';
//- //-     }

//- //-     // Marcar teléfonos como modificados
//- //-     function marcarTelefonosModificados() {
//- //-       document.getElementById('tel-mod').value = '1';
//- //-     }

//- //-     // Agregar nuevo teléfono
//- //-     function agregarTelefono() {
//- //-       marcarTelefonosModificados();

//- //-       const cont = document.getElementById('telefonos-container');
//- //-       const div = document.createElement('div');
//- //-       div.className = 'input-group mb-2';

//- //-       const input = document.createElement('input');
//- //-       input.className = 'form-control';
//- //-       input.type = 'text';
//- //-       input.name = 'telefonos';
//- //-       input.oninput = marcarTelefonosModificados;

//- //-       const btn = document.createElement('button');
//- //-       btn.type = 'button';
//- //-       btn.className = 'btn btn-outline-danger';
//- //-       btn.textContent = '✕';
//- //-       btn.onclick = () => {
//- //-         marcarTelefonosModificados();
//- //-         div.remove();
//- //-       };

//- //-       div.appendChild(input);
//- //-       div.appendChild(btn);
//- //-       cont.appendChild(div);
//- //-     }

//- //-     // Agregar nueva especialidad
//- //-     function agregarEspecialidad() {
//- //-       const select = document.getElementById('select-especialidad');
//- //-       const id = select.value;
//- //-       if (!id) return;

//- //-       marcarEspecialidadesModificadas();

//- //-       const nombre = select.options[select.selectedIndex].dataset.nombre;
//- //-       const cont = document.getElementById('especialidades-container');

//- //-       // Evitar duplicados
//- //-       if ([...cont.querySelectorAll('input[type="hidden"]')]
//- //-           .some(i => i.value === id)) return;

//- //-       const div = document.createElement('div');
//- //-       div.className = 'input-group mb-2';
//- //-       div.innerHTML = `
//- //-         <input class="form-control" readonly value="${nombre}" />
//- //-         <input type="hidden" name="especialidades" value="${id}" />
//- //-         <button class="btn btn-outline-danger" type="button"
//- //-           onclick="marcarEspecialidadesModificadas(); this.parentElement.remove()">✕</button>
//- //-       `;

//- //-       cont.appendChild(div);
//- //-       select.value = '';
//- //-     }


//- extends ../layout

//- block contenido
//-   a.btn.btn-outline-dark.mb-3(href="/medicos") ← Volver a Médicos

//-   h2.text-center Editar Médico

//-   // ======================
//-   // ESTADO
//-   // ======================
//-   hr
//-   h5.text-center Estado del Profesional
//-   p.text-center(class= medico.estado == 1 ? 'text-success' : 'text-danger')
//-     | #{medico.estado == 1 ? 'Activo' : 'Inactivo'}

//-   .mb-3.text-center
//-     if medico.estado == 1
//-       form(method="POST" action=`/medicos/inactivar/${medico.id_medico}`)
//-         button.btn.btn-danger(type="submit") Inactivar
//-     else
//-       form(method="POST" action=`/medicos/activar/${medico.id_medico}`)
//-         button.btn.btn-success(type="submit") Activar

//-   // ======================
//-   // FORMULARIO
//-   // ======================
//-   hr
//-   form(
//-     action=`/medicos/update/${medico.id_medico}`
//-     method="POST"
//-     novalidate
//-   )
//-     // IDS
//-     input(type="hidden" name="id_persona" value=persona.id)
//-     input(type="hidden" name="id_usuario" value=usuario.id)

//-     // FLAGS
//-     input(type="hidden" name="especialidades_modificadas" value="0" id="esp-mod")
//-     input(type="hidden" name="telefonos_modificados" value="0" id="tel-mod")

//-     .row
//-       .col-md-6.mb-3
//-         label.form-label Nombre
//-         input.form-control(type="text" name="nombre" value=persona.nombre required)
//-         .invalid-feedback El nombre es obligatorio

//-       .col-md-6.mb-3
//-         label.form-label Apellido
//-         input.form-control(type="text" name="apellido" value=persona.apellido required)
//-         .invalid-feedback El apellido es obligatorio

//-       .col-md-6.mb-3
//-         label.form-label Fecha de nacimiento
//-         input.form-control(
//-           type="date"
//-           name="nacimiento"
//-           value=persona.nacimiento
//-             ? persona.nacimiento.toISOString().split('T')[0]
//-             : ''
//-           required
//-         )
//-         .invalid-feedback Fecha inválida

//-       .col-md-6.mb-3
//-         label.form-label Email
//-         input.form-control(type="email" name="email" value=usuario.email required)
//-         .invalid-feedback Email inválido

//-       .col-md-6.mb-3
//-         label.form-label Nueva contraseña
//-         input.form-control(type="password" name="password" placeholder="Opcional")

//-       .col-md-6.mb-3
//-         label.form-label Matrícula
//-         input.form-control(type="text" name="matricula" value=medico.matricula required)
//-         .invalid-feedback Matrícula obligatoria

//-     // ======================
//-     // TELÉFONOS
//-     // ======================
//-     hr
//-     h5 Teléfonos

//-     #telefonos-container
//-       each tel in (medico.telefonos || '').split(', ')
//-         if tel
//-           .input-group.mb-2
//-             input.form-control(
//-               type="text"
//-               name="telefonos"
//-               value=tel
//-             )
//-             button.btn.btn-outline-danger(type="button" onclick="marcarTelefonosModificados(); this.parentElement.remove()") ✕

//-     button.btn.btn-outline-primary.btn-sm(type="button" onclick="agregarTelefono()")
//-       | + Agregar teléfono

//-     // ======================
//-     // ESPECIALIDADES
//-     // ======================
//-     hr
//-     h5 Especialidades

//-     #especialidades-container
//-       each esp in especialidadesAsignadas
//-         .input-group.mb-2
//-           input.form-control(type="text" readonly value=esp.nombre)
//-           input(type="hidden" name="especialidades" value=esp.id_especialidad)
//-           button.btn.btn-outline-danger(
//-             type="button"
//-             onclick="marcarEspecialidadesModificadas(); this.parentElement.remove()"
//-           ) ✕

//-     select.form-select.mt-2#select-especialidad
//-       option(value="") + Agregar especialidad
//-       each esp in especialidades
//-         option(value=esp.id data-nombre=esp.nombre)= esp.nombre

//-     button.btn.btn-outline-primary.mt-2(type="button" onclick="agregarEspecialidad()")
//-       | Agregar especialidad

//-     // ======================
//-     // GUARDAR
//-     // ======================
//-     .mt-4.text-end
//-       button.btn.btn-success(type="submit") Guardar cambios

//-   // ======================
//-   // SCRIPTS
//-   // ======================
//-   script.
//-     const form = document.querySelector('form');

//-     function marcarEspecialidadesModificadas() {
//-       document.getElementById('esp-mod').value = '1';
//-     }

//-     function marcarTelefonosModificados() {
//-       document.getElementById('tel-mod').value = '1';
//-     }

//-     function agregarTelefono() {
//-       marcarTelefonosModificados();
//-       const cont = document.getElementById('telefonos-container');
//-       const div = document.createElement('div');
//-       div.className = 'input-group mb-2';

//-       div.innerHTML = `
//-         <input class="form-control" type="text" name="telefonos">
//-         <button class="btn btn-outline-danger" type="button">✕</button>
//-       `;

//-       div.querySelector('button').onclick = () => {
//-         marcarTelefonosModificados();
//-         div.remove();
//-       };

//-       cont.appendChild(div);
//-     }

//-     function agregarEspecialidad() {
//-       const select = document.getElementById('select-especialidad');
//-       const id = select.value;
//-       if (!id) return;

//-       marcarEspecialidadesModificadas();

//-       const nombre = select.options[select.selectedIndex].dataset.nombre;
//-       const cont = document.getElementById('especialidades-container');

//-       if ([...cont.querySelectorAll('input[type="hidden"]')].some(i => i.value === id)) return;

//-       const div = document.createElement('div');
//-       div.className = 'input-group mb-2';
//-       div.innerHTML = `
//-         <input class="form-control" readonly value="${nombre}">
//-         <input type="hidden" name="especialidades" value="${id}">
//-         <button class="btn btn-outline-danger" type="button">✕</button>
//-       `;

//-       div.querySelector('button').onclick = () => {
//-         marcarEspecialidadesModificadas();
//-         div.remove();
//-       };

//-       cont.appendChild(div);
//-       select.value = '';
//-     }

//-     // ======================
//-     // VALIDACIÓN ANTES DE ENVIAR
//-     // ======================
//-     form.addEventListener('submit', e => {
//-       let valido = true;

//-       form.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));

//-       const requeridos = ['nombre', 'apellido', 'email', 'matricula'];
//-       requeridos.forEach(name => {
//-         const input = form.querySelector(`[name="${name}"]`);
//-         if (!input.value.trim()) {
//-           input.classList.add('is-invalid');
//-           valido = false;
//-         }
//-       });

//-       const email = form.querySelector('[name="email"]');
//-       if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value)) {
//-         email.classList.add('is-invalid');
//-         valido = false;
//-       }

//-       const telefonos = form.querySelectorAll('[name="telefonos"]');
//-       telefonos.forEach(t => {
//-         if (t.value && !/^[0-9+\-\s()]{8,15}$/.test(t.value)) {
//-           t.classList.add('is-invalid');
//-           valido = false;
//-         }
//-       });

//-       if (!valido) {
//-         e.preventDefault();
//-         e.stopPropagation();
//-       }
//-     });




//- extends ../layout

//- block contenido
//-   .container.mt-4.mb-4
//-     h2.text-center.mb-3 Editar Médico

//-     .d-flex.justify-content-between.mb-3
//-       a.btn.btn-outline-secondary(href="/medicos")
//-         i.bi.bi-arrow-left
//-         |  Volver a Médicos

//-       if medico.estado == 1
//-         form(method="POST" action=`/medicos/inactivar/${medico.id_medico}`)
//-           button.btn.btn-danger.btn-sm(type="submit")
//-             i.bi.bi-x-circle
//-             |  Inactivar
//-       else
//-         form(method="POST" action=`/medicos/activar/${medico.id_medico}`)
//-           button.btn.btn-success.btn-sm(type="submit")
//-             i.bi.bi-check-circle
//-             |  Activar

//-     form(
//-       action=`/medicos/update/${medico.id_medico}`
//-       method="POST"
//-       novalidate
//-     )

//-       // =========================
//-       // IDS + FLAGS
//-       // =========================
//-       input(type="hidden" name="id_persona" value=persona.id)
//-       input(type="hidden" name="id_usuario" value=usuario.id)
//-       input(type="hidden" name="especialidades_modificadas" value="0" id="esp-mod")
//-       input(type="hidden" name="telefonos_modificados" value="0" id="tel-mod")

//-       // =========================
//-       // DATOS PERSONALES
//-       // =========================
//-       .card.mb-3.shadow-sm
//-         .card-header.bg-primary.text-white
//-           strong Datos Personales

//-         .card-body
//-           .row.g-3
//-             .col-md-3
//-               label.form-label Nombre
//-               input.form-control(type="text" name="nombre" value=persona.nombre required)

//-             .col-md-3
//-               label.form-label Apellido
//-               input.form-control(type="text" name="apellido" value=persona.apellido required)

//-             .col-md-3
//-               label.form-label Fecha Nacimiento
//-               input.form-control(
//-                 type="date"
//-                 name="nacimiento"
//-                 value=persona.nacimiento
//-                   ? persona.nacimiento.toISOString().split('T')[0]
//-                   : ''
//-                 required
//-               )

//-             .col-md-3
//-               label.form-label Matrícula
//-               input.form-control(type="text" name="matricula" value=medico.matricula required)

//-       // =========================
//-       // USUARIO
//-       // =========================
//-       .card.mb-3.shadow-sm
//-         .card-header.bg-secondary.text-white
//-           strong Usuario

//-         .card-body
//-           .row.g-3
//-             .col-md-6
//-               label.form-label Email
//-               input.form-control(type="email" name="email" value=usuario.email required)

//-             .col-md-6
//-               label.form-label Nueva contraseña
//-               input.form-control(
//-                 type="password"
//-                 name="password"
//-                 placeholder="Opcional"
//-               )

//-       // =========================
//-       // TELÉFONOS
//-       // =========================
//-       .card.mb-3.shadow-sm
//-         .card-header.bg-dark.text-white.d-flex.justify-content-between.align-items-center
//-           strong Teléfonos
//-           button.btn.btn-sm.btn-success(type="button" onclick="agregarTelefono()")
//-             i.bi.bi-plus
//-             |  Agregar

//-         .card-body#telefonos-container
//-           each tel in (medico.telefonos || '').split(', ')
//-             if tel
//-               .input-group.mb-2
//-                 input.form-control(
//-                   type="text"
//-                   name="telefonos"
//-                   value=tel
//-                   oninput="marcarTelefonosModificados()"
//-                 )
//-                 button.btn.btn-outline-danger(type="button"
//-                   onclick="marcarTelefonosModificados(); this.parentElement.remove()")
//-                   i.bi.bi-trash

//-       // =========================
//-       // ESPECIALIDADES
//-       // =========================
//-       .card.mb-3.shadow-sm
//-         .card-header.bg-info.text-white
//-           strong Especialidades

//-         .card-body
//-           #especialidades-container
//-             each esp in especialidadesAsignadas
//-               .input-group.mb-2
//-                 input.form-control(readonly value=esp.nombre)
//-                 input(type="hidden" name="especialidades" value=esp.id_especialidad)
//-                 button.btn.btn-outline-danger(type="button"
//-                   onclick="marcarEspecialidadesModificadas(); this.parentElement.remove()")
//-                   i.bi.bi-trash

//-           .row.g-2.mt-2
//-             .col-md-8
//-               select.form-select#select-especialidad
//-                 option(value="") + Agregar especialidad
//-                 each esp in especialidades
//-                   option(value=esp.id data-nombre=esp.nombre)= esp.nombre

//-             .col-md-4
//-               button.btn.btn-outline-primary.w-100(
//-                 type="button"
//-                 onclick="agregarEspecialidad()"
//-               ) Agregar

//-       // =========================
//-       // GUARDAR
//-       // =========================
//-       .d-flex.justify-content-end.mt-3
//-         button.btn.btn-success.px-4(type="submit")
//-           i.bi.bi-save
//-           |  Guardar cambios

//-   // =========================
//-   // SCRIPTS
//-   // =========================
//-   script.
//-     function marcarEspecialidadesModificadas() {
//-       document.getElementById('esp-mod').value = '1';
//-     }

//-     function marcarTelefonosModificados() {
//-       document.getElementById('tel-mod').value = '1';
//-     }

//-     function agregarTelefono() {
//-       marcarTelefonosModificados();
//-       const cont = document.getElementById('telefonos-container');
//-       const div = document.createElement('div');
//-       div.className = 'input-group mb-2';
//-       div.innerHTML = `
//-         <input class="form-control" type="text" name="telefonos">
//-         <button class="btn btn-outline-danger" type="button">
//-           <i class="bi bi-trash"></i>
//-         </button>
//-       `;
//-       div.querySelector('button').onclick = () => {
//-         marcarTelefonosModificados();
//-         div.remove();
//-       };
//-       cont.appendChild(div);
//-     }

//-     function agregarEspecialidad() {
//-       const select = document.getElementById('select-especialidad');
//-       const id = select.value;
//-       if (!id) return;

//-       marcarEspecialidadesModificadas();

//-       const nombre = select.options[select.selectedIndex].dataset.nombre;
//-       const cont = document.getElementById('especialidades-container');

//-       if ([...cont.querySelectorAll('input[type="hidden"]')].some(i => i.value === id)) return;

//-       const div = document.createElement('div');
//-       div.className = 'input-group mb-2';
//-       div.innerHTML = `
//-         <input class="form-control" readonly value="${nombre}">
//-         <input type="hidden" name="especialidades" value="${id}">
//-         <button class="btn btn-outline-danger" type="button">
//-           <i class="bi bi-trash"></i>
//-         </button>
//-       `;
//-       div.querySelector('button').onclick = () => {
//-         marcarEspecialidadesModificadas();
//-         div.remove();
//-       };
//-       cont.appendChild(div);
//-       select.value = '';
//-     }

extends ../layout

block contenido
  .container.mt-4.mb-5
    // Encabezado
    .row.mb-4
      .col-12.d-flex.justify-content-between.align-items-center
        div
          h2.fw-bold.text-primary 
            i.bi.bi-person-badge-fill.me-2
            | Editar Médico
          p.text-muted Actualice la información del profesional y sus credenciales.
        a.btn.btn-outline-secondary.btn-sm.shadow-sm(href="/medicos")
          i.bi.bi-arrow-left.me-1
          | Volver al listado

    // Botones de Estado (Alta/Baja)
    .row.mb-3
      .col-12.d-flex.justify-content-end
        if medico.estado == 1
          form(method="POST" action=`/medicos/inactivar/${medico.id_medico}`)
            button.btn.btn-danger.btn-sm.px-3.shadow-sm(type="submit")
              i.bi.bi-person-x.me-1
              | Dar de Baja al Médico
        else
          form(method="POST" action=`/medicos/activar/${medico.id_medico}`)
            button.btn.btn-success.btn-sm.px-3.shadow-sm(type="submit")
              i.bi.bi-person-check.me-1
              | Reactivar Médico

    // Formulario Principal
    form.needs-validation(
      action=`/medicos/update/${medico.id_medico}`
      method="POST"
      novalidate
    )
      // ID y Flags ocultos
      input(type="hidden" name="id_persona" value=persona.id)
      input(type="hidden" name="id_usuario" value=usuario.id)
      input(type="hidden" name="especialidades_modificadas" value="0" id="esp-mod")
      input(type="hidden" name="telefonos_modificados" value="0" id="tel-mod")

      .row
        // Columna Izquierda: Datos Personales y Usuario
        .col-lg-8
          // SECCIÓN 1: DATOS PERSONALES
          .card.border-0.shadow-sm.mb-4
            .card-header.bg-white.py-3
              h5.card-title.mb-0.text-primary
                i.bi.bi-person-lines-fill.me-2
                | Información Personal
            .card-body
              .row.g-3
                .col-md-6
                  label.form-label.fw-bold Nombre
                  input.form-control(type="text" name="nombre" value=persona.nombre required)
                  .invalid-feedback Ingrese el nombre.
                
                .col-md-6
                  label.form-label.fw-bold Apellido
                  input.form-control(type="text" name="apellido" value=persona.apellido required)
                  .invalid-feedback Ingrese el apellido.

                .col-md-6
                  label.form-label.fw-bold Fecha de Nacimiento
                  input.form-control(
                    type="date"
                    name="nacimiento"
                    value=persona.nacimiento ? persona.nacimiento.toISOString().split('T')[0] : ''
                    required
                  )
                
                .col-md-6
                  label.form-label.fw-bold Matrícula Profesional
                  input.form-control(type="text" name="matricula" value=medico.matricula required)
                  .invalid-feedback La matrícula es obligatoria.

          // SECCIÓN 2: USUARIO Y ACCESO
          .card.border-0.shadow-sm.mb-4
            .card-header.bg-white.py-3
              h5.card-title.mb-0.text-primary
                i.bi.bi-shield-lock-fill.me-2
                | Credenciales de Acceso
            .card-body
              .row.g-3
                .col-md-6
                  label.form-label.fw-bold Correo Electrónico
                  .input-group
                    span.input-group-text @
                    input.form-control(type="email" name="email" value=usuario.email required)
                
                .col-md-6
                  label.form-label.fw-bold Cambiar Contraseña
                  input.form-control(
                    type="password"
                    name="password"
                    placeholder="Dejar en blanco para no cambiar"
                  )
                  small.text-muted Solo complete si desea actualizar la clave.

        // Columna Derecha: Especialidades y Teléfonos
        .col-lg-4
          // SECCIÓN 3: ESPECIALIDADES
          .card.border-0.shadow-sm.mb-4
            .card-header.bg-white.py-3.d-flex.justify-content-between.align-items-center
              h5.card-title.mb-0.text-primary
                i.bi.bi-stethoscope.me-2
                | Especialidades
            .card-body
              #especialidades-container.mb-3
                each esp in especialidadesAsignadas
                  .badge.bg-light.text-dark.border.d-flex.justify-content-between.align-items-center.p-2.mb-2.w-100(style="font-size: 0.9rem;")
                    span= esp.nombre
                    input(type="hidden" name="especialidades" value=esp.id_especialidad)
                    button.btn-close(type="button" onclick="marcarEspecialidadesModificadas(); this.parentElement.remove()")
              
              hr
              label.form-label.small.fw-bold Agregar Nueva
              .input-group
                select.form-select.form-select-sm#select-especialidad
                  option(value="") Seleccionar...
                  each esp in especialidades
                    option(value=esp.id data-nombre=esp.nombre)= esp.nombre
                button.btn.btn-primary.btn-sm(type="button" onclick="agregarEspecialidad()") 
                  i.bi.bi-plus-lg

          // SECCIÓN 4: TELÉFONOS
          .card.border-0.shadow-sm.mb-4
            .card-header.bg-white.py-3.d-flex.justify-content-between.align-items-center
              h5.card-title.mb-0.text-primary
                i.bi.bi-telephone-fill.me-2
                | Contactos
              button.btn.btn-sm.btn-outline-success(type="button" onclick="agregarTelefono()")
                i.bi.bi-plus-lg
            .card-body
              #telefonos-container
                each tel in (medico.telefonos || '').split(', ')
                  if tel
                    .input-group.mb-2
                      input.form-control.form-control-sm(
                        type="text"
                        name="telefonos"
                        value=tel
                        oninput="marcarTelefonosModificados()"
                      )
                      button.btn.btn-outline-danger.btn-sm(type="button" onclick="marcarTelefonosModificados(); this.parentElement.remove()")
                        i.bi.bi-trash

      // Botones de Acción
      .row.mt-3
        .col-12.d-flex.justify-content-end.gap-2
          a.btn.btn-light.px-4(href="/medicos") Cancelar
          button.btn.btn-primary.px-5.shadow(type="submit")
            i.bi.bi-check-lg.me-1
            | Guardar Cambios

  // Script de funcionalidad
  script.
    // Marcar flags de cambios
    function marcarEspecialidadesModificadas() {
      document.getElementById('esp-mod').value = '1';
    }

    function marcarTelefonosModificados() {
      document.getElementById('tel-mod').value = '1';
    }

    // Agregar Teléfono Dinámico
    function agregarTelefono() {
      marcarTelefonosModificados();
      const cont = document.getElementById('telefonos-container');
      const div = document.createElement('div');
      div.className = 'input-group mb-2 animate__animated animate__fadeIn';
      div.innerHTML = `
        <input class="form-control form-control-sm" type="text" name="telefonos" placeholder="Número">
        <button class="btn btn-outline-danger btn-sm" type="button">
          <i class="bi bi-trash"></i>
        </button>
      `;
      div.querySelector('button').onclick = () => {
        marcarTelefonosModificados();
        div.remove();
      };
      cont.appendChild(div);
    }

    // Agregar Especialidad Dinámica
    function agregarEspecialidad() {
      const select = document.getElementById('select-especialidad');
      const id = select.value;
      if (!id) return;

      marcarEspecialidadesModificadas();

      const nombre = select.options[select.selectedIndex].dataset.nombre;
      const cont = document.getElementById('especialidades-container');

      // Evitar duplicados
      if ([...cont.querySelectorAll('input[type="hidden"]')].some(i => i.value === id)) {
        alert('Esta especialidad ya ha sido agregada.');
        return;
      }

      const div = document.createElement('div');
      div.className = 'badge bg-light text-dark border d-flex justify-content-between align-items-center p-2 mb-2 w-100 animate__animated animate__fadeIn';
      div.style.fontSize = '0.9rem';
      div.innerHTML = `
        <span>${nombre}</span>
        <input type="hidden" name="especialidades" value="${id}">
        <button class="btn-close" type="button"></button>
      `;
      div.querySelector('button').onclick = () => {
        marcarEspecialidadesModificadas();
        div.remove();
      };
      cont.appendChild(div);
      select.value = '';
    }

    // Validación de Bootstrap
    (function () {
      'use strict'
      var forms = document.querySelectorAll('.needs-validation')
      Array.prototype.slice.call(forms).forEach(function (form) {
        form.addEventListener('submit', function (event) {
          if (!form.checkValidity()) {
            event.preventDefault()
            event.stopPropagation()
          }
          form.classList.add('was-validated')
        }, false)
      })
    })()