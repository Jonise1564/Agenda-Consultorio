//- extends ../layout

//- block contenido
//-   .container.mt-4.mb-4
//-     h2.text-center.mb-3 Crear Médico

//-     .d-flex.justify-content-between.mb-3
//-       a.btn.btn-outline-secondary(href="/medicos")
//-         i.bi.bi-arrow-left
//-         |  Volver a Médicos

//-     // =========================
//-     // ERRORES BACKEND
//-     // =========================
//-     if errores && errores.length
//-       .alert.alert-danger
//-         ul.mb-0
//-           each err in errores
//-             li= err

//-     // =========================
//-     // FORMULARIO
//-     // =========================
//-     form(
//-       action="/medicos"
//-       method="POST"
//-       novalidate
//-     )

//-       // =========================
//-       // DATOS PERSONALES
//-       // =========================
//-       .card.mb-3.shadow-sm
//-         .card-header.bg-primary.text-white
//-           strong Datos Personales

//-         .card-body
//-           .row.g-3
//-             .col-md-3
//-               label.form-label Nombre
//-               input.form-control(
//-                 type="text"
//-                 name="nombre"
//-                 value=(old && old.nombre ? old.nombre : '')
//-                 required
//-               )

//-             .col-md-3
//-               label.form-label Apellido
//-               input.form-control(
//-                 type="text"
//-                 name="apellido"
//-                 value=(old && old.apellido ? old.apellido : '')
//-                 required
//-               )

//-             .col-md-3
//-               label.form-label DNI
//-               input.form-control(
//-                 type="text"
//-                 name="dni"
//-                 value=(old && old.dni ? old.dni : '')
//-                 required
//-               )

//-             .col-md-3
//-               label.form-label Fecha Nacimiento
//-               input.form-control(
//-                 type="date"
//-                 name="nacimiento"
//-                 value=(old && old.nacimiento ? old.nacimiento : '')
//-                 required
//-               )

//-             .col-md-3
//-               label.form-label Matrícula
//-               input.form-control(
//-                 type="text"
//-                 name="matricula"
//-                 value=(old && old.matricula ? old.matricula : '')
//-                 required
//-               )

//-       // =========================
//-       // USUARIO
//-       // =========================
//-       .card.mb-3.shadow-sm
//-         .card-header.bg-secondary.text-white
//-           strong Usuario

//-         .card-body
//-           .row.g-3
//-             .col-md-6
//-               label.form-label Email
//-               input.form-control(
//-                 type="email"
//-                 name="email"
//-                 value=(old && old.email ? old.email : '')
//-                 required
//-               )

//-             .col-md-6
//-               label.form-label Contraseña
//-               input.form-control(
//-                 type="password"
//-                 name="password"
//-                 required
//-               )

//-             .col-md-6
//-               label.form-label Repetir contraseña
//-               input.form-control(
//-                 type="password"
//-                 name="repeatPassword"
//-                 required
//-               )

//-       // =========================
//-       // TELÉFONOS
//-       // =========================
//-       .card.mb-3.shadow-sm
//-         .card-header.bg-dark.text-white.d-flex.justify-content-between.align-items-center
//-           strong Teléfonos
//-           button.btn.btn-sm.btn-success(type="button" onclick="agregarTelefono()")
//-             i.bi.bi-plus
//-             |  Agregar

//-         .card-body#telefonos-container
//-           if old && old.telefonos
//-             - const tels = Array.isArray(old.telefonos) ? old.telefonos : [old.telefonos]
//-             each tel in tels
//-               .input-group.mb-2
//-                 input.form-control(type="text" name="telefonos" value=tel)
//-                 button.btn.btn-outline-danger(type="button" onclick="this.parentNode.remove()")
//-                   i.bi.bi-trash

//-       // =========================
//-       // ESPECIALIDADES
//-       // =========================
//-       .card.mb-3.shadow-sm
//-         .card-header.bg-info.text-white
//-           strong Especialidades

//-         .card-body
//-           #especialidades-container
//-             if old && old.especialidades
//-               - const espOld = Array.isArray(old.especialidades) ? old.especialidades : [old.especialidades]
//-               each espId in espOld
//-                 - const esp = especialidades.find(e => String(e.id) === String(espId))
//-                 if esp
//-                   .input-group.mb-2
//-                     input.form-control(readonly value=esp.nombre)
//-                     input(type="hidden" name="especialidades" value=esp.id)
//-                     button.btn.btn-outline-danger(type="button" onclick="this.parentNode.remove()")
//-                       i.bi.bi-trash

//-           .row.g-2.mt-2
//-             .col-md-8
//-               select.form-select#select-especialidad
//-                 option(value="") + Agregar especialidad
//-                 each esp in especialidades
//-                   option(value=esp.id data-nombre=esp.nombre)= esp.nombre

//-             .col-md-4
//-               button.btn.btn-outline-primary.w-100(
//-                 type="button"
//-                 onclick="agregarEspecialidad()"
//-               ) Agregar

//-       // =========================
//-       // GUARDAR
//-       // =========================
//-       .d-flex.justify-content-end.mt-3
//-         button.btn.btn-success.px-4(type="submit")
//-           i.bi.bi-save
//-           |  Crear médico

//-   // =========================
//-   // SCRIPTS
//-   // =========================
//-   script.
//-     function agregarTelefono() {
//-       const cont = document.getElementById('telefonos-container');
//-       const div = document.createElement('div');
//-       div.className = 'input-group mb-2';
//-       div.innerHTML = `
//-         <input class="form-control" type="text" name="telefonos">
//-         <button class="btn btn-outline-danger" type="button">
//-           <i class="bi bi-trash"></i>
//-         </button>
//-       `;
//-       div.querySelector('button').onclick = () => div.remove();
//-       cont.appendChild(div);
//-     }

//-     function agregarEspecialidad() {
//-       const select = document.getElementById('select-especialidad');
//-       const id = select.value;
//-       if (!id) return;

//-       const nombre = select.options[select.selectedIndex].dataset.nombre;
//-       const cont = document.getElementById('especialidades-container');

//-       if ([...cont.querySelectorAll('input[type="hidden"]')].some(i => i.value === id)) return;

//-       const div = document.createElement('div');
//-       div.className = 'input-group mb-2';
//-       div.innerHTML = `
//-         <input class="form-control" readonly value="${nombre}">
//-         <input type="hidden" name="especialidades" value="${id}">
//-         <button class="btn btn-outline-danger" type="button">
//-           <i class="bi bi-trash"></i>
//-         </button>
//-       `;
//-       div.querySelector('button').onclick = () => div.remove();
//-       cont.appendChild(div);
//-       select.value = '';
//-     }

extends ../layout

block contenido
  //- Encabezado de página
  .d-flex.justify-content-between.align-items-center.mb-4
    h2.m-0
      i.fa-solid.fa-user-plus.me-2.text-primary
      | Crear Médico
    a.btn.btn-outline-secondary.btn-sm(href="/medicos")
      i.bi.bi-arrow-left.me-1
      | Volver a Médicos

  //- Errores de Backend
  if errores && errores.length
    .alert.alert-danger.shadow-sm
      ul.mb-0
        each err in errores
          li= err

  //- Formulario Principal
  form(action="/medicos" method="POST" novalidate)
    
    //- SECCIÓN: DATOS PERSONALES
    .card-custom
      h5.mb-3.text-primary
        i.fa-solid.fa-id-card.me-2
        | Datos Personales
      .row.g-3
        .col-md-4
          label.form-label Nombre
          input.form-control(type="text" name="nombre" value=(old && old.nombre ? old.nombre : '') required)
        .col-md-4
          label.form-label Apellido
          input.form-control(type="text" name="apellido" value=(old && old.apellido ? old.apellido : '') required)
        .col-md-4
          label.form-label DNI
          input.form-control(type="text" name="dni" value=(old && old.dni ? old.dni : '') required)
        .col-md-6
          label.form-label Fecha de Nacimiento
          input.form-control(type="date" name="nacimiento" value=(old && old.nacimiento ? old.nacimiento : '') required)
        .col-md-6
          label.form-label Matrícula Profesional
          input.form-control(type="text" name="matricula" value=(old && old.matricula ? old.matricula : '') required)

    //- SECCIÓN: CREDENCIALES DE ACCESO
    .card-custom
      h5.mb-3.text-secondary
        i.fa-solid.fa-lock.me-2
        | Cuenta de Usuario
      .row.g-3
        .col-md-12
          label.form-label Correo Electrónico (Email)
          input.form-control(type="email" name="email" value=(old && old.email ? old.email : '') required)
        .col-md-6
          label.form-label Contraseña
          input.form-control(type="password" name="password" required)
        .col-md-6
          label.form-label Repetir Contraseña
          input.form-control(type="password" name="repeatPassword" required)

    .row
      //- SECCIÓN: TELÉFONOS
      .col-md-6
        .card-custom
          .d-flex.justify-content-between.align-items-center.mb-3
            h5.m-0.text-dark
              i.fa-solid.fa-phone.me-2
              | Teléfonos
            button.btn.btn-sm.btn-success(type="button" onclick="agregarTelefono()")
              i.bi.bi-plus-lg
          
          #telefonos-container
            if old && old.telefonos
              - const tels = Array.isArray(old.telefonos) ? old.telefonos : [old.telefonos]
              each tel in tels
                .input-group.mb-2
                  input.form-control(type="text" name="telefonos" value=tel)
                  button.btn.btn-outline-danger(type="button" onclick="this.parentNode.remove()")
                    i.bi.bi-trash

      //- SECCIÓN: ESPECIALIDADES
      .col-md-6
        .card-custom
          h5.mb-3.text-dark
            i.fa-solid.fa-stethoscope.me-2
            | Especialidades
          
          #especialidades-container
            if old && old.especialidades
              - const espOld = Array.isArray(old.especialidades) ? old.especialidades : [old.especialidades]
              each espId in espOld
                - const esp = especialidades.find(e => String(e.id) === String(espId))
                if esp
                  .input-group.mb-2
                    input.form-control(readonly value=esp.nombre)
                    input(type="hidden" name="especialidades" value=esp.id)
                    button.btn.btn-outline-danger(type="button" onclick="this.parentNode.remove()")
                      i.bi.bi-trash

          .row.g-2.mt-2
            .col-8
              select.form-select#select-especialidad
                option(value="") Seleccionar...
                each esp in especialidades
                  option(value=esp.id data-nombre=esp.nombre)= esp.nombre
            .col-4
              button.btn.btn-outline-primary.w-100(type="button" onclick="agregarEspecialidad()") Agregar

    //- BOTÓN FINAL
    .d-flex.justify-content-end.mt-4.mb-5
      button.btn-primary-custom.px-5(type="submit")
        i.bi.bi-check-circle.me-2
        | Registrar Médico

  //- SCRIPTS 
  script.
    function agregarTelefono() {
      const cont = document.getElementById('telefonos-container');
      const div = document.createElement('div');
      div.className = 'input-group mb-2';
      div.innerHTML = `
        <input class="form-control" type="text" name="telefonos" placeholder="Ej: +54 9 11...">
        <button class="btn btn-outline-danger" type="button">
          <i class="bi bi-trash"></i>
        </button>
      `;
      div.querySelector('button').onclick = () => div.remove();
      cont.appendChild(div);
    }

    function agregarEspecialidad() {
      const select = document.getElementById('select-especialidad');
      const id = select.value;
      if (!id) return;

      const nombre = select.options[select.selectedIndex].dataset.nombre;
      const cont = document.getElementById('especialidades-container');

      if ([...cont.querySelectorAll('input[type="hidden"]')].some(i => i.value === id)) return;

      const div = document.createElement('div');
      div.className = 'input-group mb-2';
      div.innerHTML = `
        <input class="form-control" readonly value="${nombre}">
        <input type="hidden" name="especialidades" value="${id}">
        <button class="btn btn-outline-danger" type="button">
          <i class="bi bi-trash"></i>
        </button>
      `;
      div.querySelector('button').onclick = () => div.remove();
      cont.appendChild(div);
      select.value = '';
    }