//- extends ../layout

//- block contenido
//-     style.
//-         .page-container {
//-             background-color: #f4f7f6;
//-             font-family: 'Segoe UI', Arial, sans-serif;
//-             padding: 20px;
//-             border-radius: 10px;
//-         }
//-         .center-text {
//-             text-align: center;
//-             margin-bottom: 20px;
//-             font-size: 28px;
//-             font-weight: bold;
//-             color: #2c3e50;
//-         }
//-         .top-actions {
//-             display: flex;
//-             justify-content: space-between;
//-             align-items: center;
//-             margin-bottom: 20px;
//-             gap: 15px;
//-         }
//-         .actions i {
//-             font-size: 20px;
//-             cursor: pointer;
//-             margin-right: 12px;
//-         }
//-         .icon-edit { color: #1e88e5; }
//-         .icon-active { color: #27ae60; }
//-         .icon-inactive { color: #e74c3c; }
//-         .total-count { font-size: 0.85rem; color: #7f8c8d; margin-top: 4px; }
//-         tr:hover { filter: brightness(0.96); }

//-     .page-container
//-         h3.center-text Gestión de Médicos

//-         //- BARRA SUPERIOR: NUEVO + BUSCADOR
//-         .top-actions
//-             div
//-                 a.btn.btn-primary(href="/medicos/crear")
//-                     i.fa-solid.fa-user-doctor.me-2
//-                     | Nuevo Médico
//-                 if totalMedicos !== undefined
//-                     .total-count Total registrados: #{totalMedicos}

//-             form.d-flex.align-items-center(method="GET" action="/medicos" style="max-width: 600px; width: 100%; gap: 15px;")
//-                 .d-flex.align-items-center.gap-2
//-                     span.small Mostrar
//-                     select.form-select.form-select-sm(name="limit" onchange="this.form.submit()" style="width: 70px;")
//-                         each val in [5, 10, 25, 50]
//-                             option(value=val selected=limit==val)= val
                
//-                 .input-group
//-                     input.form-control(type="text" name="q" placeholder="Matrícula, Nombre, Especialidad..." value=search)
//-                     button.btn.btn-secondary(type="submit")
//-                         i.fa-solid.fa-magnifying-glass
//-                     if search
//-                         a.btn.btn-outline-danger(href="/medicos" title="Limpiar") 
//-                             i.fa-solid.fa-xmark

//-         if mensaje
//-             script.
//-                 Swal.fire({
//-                     title: 'Éxito',
//-                     text: '#{mensaje}',
//-                     icon: 'success',
//-                     confirmButtonColor: '#3498db'
//-                 });

//-         //- TABLA DE RESULTADOS
//-         .table-responsive.shadow-sm.rounded.bg-white
//-             table#tablaMedicos.table.table-hover.align-middle.mb-0
//-                 thead.table-dark
//-                     tr
//-                         th DNI
//-                         th Médico
//-                         th Especialidades
//-                         th Matrícula
//-                         th Teléfonos
//-                         th Estado
//-                         th.text-center Acciones

//-                 tbody
//-                     if medicos && medicos.length > 0
//-                         each medico in medicos
//-                             - const especialidades = medico.especialidades ? medico.especialidades.split(', ') : []
//-                             - const matriculas = medico.matriculas ? medico.matriculas.split(', ') : []
//-                             - const telefonos = medico.telefonos ? medico.telefonos.split(', ') : []

//-                             tr
//-                                 td.fw-bold= medico.dni
//-                                 td= `${medico.apellido}, ${medico.nombre}`
                                
//-                                 td
//-                                     if especialidades.length === 0
//-                                         span.text-muted -
//-                                     else if especialidades.length === 1
//-                                         span.badge.bg-light.text-dark= especialidades[0]
//-                                     else
//-                                         select.form-select.form-select-sm
//-                                             each esp in especialidades
//-                                                 option= esp

//-                                 td= medico.matricula || "Sin datos"

//-                                 td
//-                                     if telefonos.length === 0
//-                                         span.text-muted -
//-                                     else if telefonos.length === 1
//-                                         span= telefonos[0]
//-                                     else
//-                                         select.form-select.form-select-sm
//-                                             each tel in telefonos
//-                                                 option= tel

//-                                 td
//-                                     span.badge(class=medico.estado === 1 ? 'bg-success' : 'bg-secondary')
//-                                         = medico.estado === 1 ? 'Activo' : 'Inactivo'

//-                                 td.text-center.actions
//-                                     .btn-group
//-                                         a(href=`/medicos/editar/${medico.id}` title="Editar"): i.icon-edit.fa-solid.fa-pen-to-square
//-                                         if medico.estado === 1
//-                                             a(href=`/medicos/inactivar/${medico.id}` title="Inactivar" onclick="return confirm('¿Inactivar médico?')")
//-                                                 i.icon-inactive.fa-solid.fa-user-slash
//-                                         else
//-                                             a(href=`/medicos/activar/${medico.id}` title="Activar")
//-                                                 i.icon-active.fa-solid.fa-user-check
//-                     else
//-                         tr
//-                             td.text-center.py-4(colspan="7") No se encontraron médicos que coincidan con la búsqueda.

//-         //- BARRA DE PAGINACIÓN
//-         if totalPages > 1
//-             nav.mt-4
//-                 ul.pagination.justify-content-center
//-                     li.page-item(class=(currentPage === 1 ? 'disabled' : ''))
//-                         a.page-link(href=`/medicos?page=${currentPage - 1}&limit=${limit}${search ? '&q='+search : ''}`) Anterior
                    
//-                     - var start = Math.max(1, currentPage - 2)
//-                     - var end = Math.min(totalPages, start + 4)
                    
//-                     - for (var n = start; n <= end; n++)
//-                         li.page-item(class=(currentPage === n ? 'active' : ''))
//-                             a.page-link(href=`/medicos?page=${n}&limit=${limit}${search ? '&q='+search : ''}`)= n
                    
//-                     li.page-item(class=(currentPage === totalPages ? 'disabled' : ''))
//-                         a.page-link(href=`/medicos?page=${currentPage + 1}&limit=${limit}${search ? '&q='+search : ''}`) Siguiente

extends ../layout

block contenido
  .container-fluid
    // Encabezado
    .row.mb-4
      .col-12.d-flex.justify-content-between.align-items-center
        div
          h2.fw-bold.text-primary 
            i.fa-solid.fa-user-doctor.me-2
            | Gestión de Médicos
          if totalMedicos !== undefined
            span.badge.bg-light.text-dark.border 
              i.bi.bi-person-badge.me-1
              | Total: #{totalMedicos} profesionales
        
        a.btn.btn-primary.shadow-sm(href="/medicos/crear")
          i.fa-solid.fa-user-plus.me-2
          | Nuevo Médico

    // Filtros y Buscador
    .card.border-0.shadow-sm.mb-4
      .card-body
        form(method="GET" action="/medicos")
          .row.g-3.align-items-center
            .col-md-auto
              .input-group.input-group-sm
                label.input-group-text Mostrar
                select.form-select(name="limit" onchange="this.form.submit()" style="width: 75px;")
                  each val in [5, 10, 25, 50]
                    option(value=val selected=limit==val)= val
            
            .col-md
              .input-group
                span.input-group-text.bg-white
                  i.fa-solid.fa-magnifying-glass.text-muted
                input.form-control(
                  type="text" 
                  name="q" 
                  placeholder="Buscar por Matrícula, Nombre o Especialidad..." 
                  value=search
                )
                if search
                  a.btn.btn-outline-secondary(href="/medicos")
                    i.fa-solid.fa-xmark
                button.btn.btn-primary.px-4(type="submit") Buscar

    // Mensaje de SweetAlert
    if mensaje
      script.
        Swal.fire({
          title: 'Operación Exitosa',
          text: '#{mensaje}',
          icon: 'success',
          confirmButtonColor: '#0a3d62'
        });

    // Tabla de Resultados
    .card.border-0.shadow-sm
      .table-responsive
        table.table.table-hover.align-middle.mb-0
          thead.bg-light
            tr
              th.ps-3 DNI
              th Médico
              th Especialidades
              th Matrícula
              th Teléfonos
              th.text-center Estado
              th.text-center Acciones

          tbody
            if medicos && medicos.length > 0
              each medico in medicos
                - const especialidades = medico.especialidades ? medico.especialidades.split(', ') : []
                - const telefonos = medico.telefonos ? medico.telefonos.split(', ') : []
                
                tr
                  td.ps-3.fw-bold= medico.dni
                  td
                    div.fw-bold= `${medico.apellido}, ${medico.nombre}`
                    small.text-muted Profesional de Salud
                  td
                    if especialidades.length === 0
                      span.text-muted.small -
                    else if especialidades.length === 1
                      span.badge.bg-primary.bg-opacity-10.text-primary.border.border-primary.small= especialidades[0]
                    else
                      select.form-select.form-select-sm(style="max-width: 150px;")
                        each esp in especialidades
                          option= esp
                  td
                    span.font-monospace= medico.matricula || "N/A"
                  td
                    if telefonos.length === 0
                      span.text-muted.small -
                    else if telefonos.length === 1
                      span.small= telefonos[0]
                    else
                      select.form-select.form-select-sm(style="max-width: 130px;")
                        each tel in telefonos
                          option= tel
                  td.text-center
                    if medico.estado === 1
                      span.badge.rounded-pill.bg-success Activo
                    else
                      span.badge.rounded-pill.bg-danger Inactivo
                  td.text-center
                    .btn-group.btn-group-sm
                      a.btn.btn-outline-primary(href=`/medicos/editar/${medico.id}` title="Editar")
                        i.fa-solid.fa-pen-to-square
                      if medico.estado === 1
                        a.btn.btn-outline-danger(
                          href=`/medicos/inactivar/${medico.id}` 
                          title="Inactivar" 
                          onclick="return confirm('¿Seguro desea inactivar este profesional?')"
                        )
                          i.fa-solid.fa-user-slash
                      else
                        a.btn.btn-outline-success(href=`/medicos/activar/${medico.id}` title="Activar")
                          i.fa-solid.fa-user-check
            else
              tr
                td.text-center.py-5(colspan="7")
                  p.text-muted No se encontraron médicos registrados.

    // Paginación
    if totalPages > 1
      nav.mt-4
        ul.pagination.justify-content-center
          li.page-item(class=(currentPage === 1 ? 'disabled' : ''))
            a.page-link(href=`/medicos?page=${currentPage - 1}&limit=${limit}${search ? '&q='+search : ''}`)
              i.bi.bi-chevron-left
          
          - var start = Math.max(1, currentPage - 2)
          - var end = Math.min(totalPages, start + 4)
          if (end - start < 4)
            - start = Math.max(1, end - 4)
          
          - for (var n = Math.max(1, start); n <= end; n++)
            li.page-item(class=(currentPage === n ? 'active' : ''))
              a.page-link(href=`/medicos?page=${n}&limit=${limit}${search ? '&q='+search : ''}`)= n
          
          li.page-item(class=(currentPage === totalPages ? 'disabled' : ''))
            a.page-link(href=`/medicos?page=${currentPage + 1}&limit=${limit}${search ? '&q='+search : ''}`)
              i.bi.bi-chevron-right