//- //- extends ../layout

//- //- block contenido
//- //-   .container.mt-5
//- //-     h2 Crear Nuevo Paciente
//- //-     form(action="/pacientes" method="POST")
//- //-       .mb-3
//- //-         label(for="dni" class="form-label") DNI
//- //-         input#dni.form-control(type="number" name="dni" required)
//- //-       .mb-3
//- //-         label(for="nombre" class="form-label") Nombre
//- //-         input#nombre.form-control(type="text" name="nombre" required)
//- //-       .mb-3
//- //-         label(for="apellido" class="form-label") Apellido
//- //-         input#apellido.form-control(type="text" name="apellido" required)
//- //-       .mb-3
//- //-         label(for="nacimiento" class="form-label") Fecha de Nacimiento
//- //-         input#nacimiento.form-control(type="date" name="nacimiento" required)
//- //-       .mb-3
//- //-         label(for="email" class="form-label") Email
//- //-         input#email.form-control(type="email" name="email" required)
//- //-       .mb-3
//- //-         label(for="password" class="form-label") Contraseña
//- //-         input#password.form-control(type="password" name="password" required)
//- //-       .mb-3
//- //-         label(for="repeatPassword" class="form-label") Repetir Contraseña
//- //-         input#repeatPassword.form-control(type="password" name="repeatPassword" required)
//- //-       .mb-3
//- //-         label(for="id_rol" class="form-label") Rol
//- //-         select#id_rol.form-control(name="id_rol" required)
//- //-           option(value="4") Paciente
//- //-       .mb-3
//- //-         label(for="estado" class="form-label") Estado
//- //-         select#estado.form-control(name="estado" required)
//- //-           option(value="3") Seleccione
//- //-           option(value="1") Activo
//- //-           option(value="0") Inactivo
//- //-       .mb-3
//- //-         label(for="telefonos" class="form-label") Teléfono
//- //-         input#telefonos.form-control(type="text" name="telefonos" required)
//- //-       .mb-3
//- //-         label(for="obra_sociales" class="form-label") Obras Sociales Disponibles
//- //-         select#obra_sociales.form-control(name="obra_sociales" required)
//- //-           option(value="") Seleccione
//- //-           if obra_sociales
//- //-             each obra_social in obra_sociales
//- //-               option(value=obra_social.id)= obra_social.nombre
//- //-           else
//- //-             option(value="") No hay Obras Sociales disponibles
     
//- //-       button.btn.btn-primary(type="submit") Crear Paciente
//- //-     script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous")
//- //-     script(src="/js/medicos.js")

//- extends ../layout

//- block contenido
  
//-   .container.mt-4.mb-4
//-     h2.text-center.mb-3 Crear Nuevo Paciente
//-     .d-flex.justify-content-between.mb-4
//-             a.btn.btn-outline-secondary(href="/pacientes")
//-                 i.bi.bi-arrow-left
//-                 |  Volver a Pacientes

//-     form(action="/pacientes" method="POST")
      
//-       // =========================
//-       // DATOS PERSONALES
//-       // =========================
//-       .card.mb-3.shadow-sm
//-         .card-header.bg-primary.text-white
//-           strong Datos Personales

//-         .card-body
//-           .row.g-3
//-             .col-md-3
//-               label.form-label DNI
//-               input.form-control(type="number" name="dni" required)

//-             .col-md-3
//-               label.form-label Nombre
//-               input.form-control(type="text" name="nombre" required)

//-             .col-md-3
//-               label.form-label Apellido
//-               input.form-control(type="text" name="apellido" required)

//-             .col-md-3
//-               label.form-label Fecha Nacimiento
//-               input.form-control(type="date" name="nacimiento" required)

//-       // =========================
//-       // USUARIO
//-       // =========================
//-       .card.mb-3.shadow-sm
//-         .card-header.bg-secondary.text-white
//-           strong Usuario

//-         .card-body
//-           .row.g-3
//-             .col-md-4
//-               label.form-label Email
//-               input.form-control(type="email" name="email" required)

//-             .col-md-4
//-               label.form-label Contraseña
//-               input.form-control(type="password" name="password" required)

//-             .col-md-4
//-               label.form-label Repetir Contraseña
//-               input.form-control(type="password" name="repeatPassword" required)

//-       // =========================
//-       // CONFIGURACIÓN
//-       // =========================
//-       .card.mb-3.shadow-sm
//-         .card-header.bg-info.text-white
//-           strong Configuración

//-         .card-body
//-           .row.g-3
//-             .col-md-3
//-               label.form-label Rol
//-               select.form-select(name="id_rol" required)
//-                 option(value="4") Paciente

//-             .col-md-3
//-               label.form-label Estado
//-               select.form-select(name="estado" required)
//-                 option(value="") Seleccione
//-                 option(value="1") Activo
//-                 option(value="0") Inactivo

//-             .col-md-3
//-               label.form-label Teléfono
//-               input.form-control(type="text" name="telefonos" required)

//-             .col-md-3
//-               label.form-label Obra Social
//-               select.form-select(name="obra_sociales" required)
//-                 option(value="") Seleccione
//-                 if obra_sociales
//-                   each obra_social in obra_sociales
//-                     option(value=obra_social.id)= obra_social.nombre
//-                 else
//-                   option(value="") No hay disponibles

//-       // =========================
//-       // BOTÓN
//-       // =========================
//-       .d-flex.justify-content-end.mt-3
//-         button.btn.btn-success.px-4(type="submit")
//-           i.bi.bi-person-plus
//-           |  Crear Paciente

//- extends ../layout

//- block contenido

//-   .container.mt-4.mb-4
//-     h2.text-center.mb-3 Crear Nuevo Paciente

//-     .d-flex.justify-content-between.mb-3
//-       a.btn.btn-outline-secondary(href="/pacientes")
//-         i.bi.bi-arrow-left
//-         |  Volver a Pacientes

//-     form(action="/pacientes" method="POST" novalidate)

//-       // =========================
//-       // DATOS PERSONALES
//-       // =========================
//-       .card.mb-3.shadow-sm
//-         .card-header.bg-primary.text-white
//-           strong Datos Personales

//-         .card-body
//-           .row.g-3
//-             .col-md-3
//-               label.form-label DNI
//-               input.form-control(
//-                 type="number"
//-                 name="dni"
//-                 required
//-               )

//-             .col-md-3
//-               label.form-label Nombre
//-               input.form-control(
//-                 type="text"
//-                 name="nombre"
//-                 required
//-               )

//-             .col-md-3
//-               label.form-label Apellido
//-               input.form-control(
//-                 type="text"
//-                 name="apellido"
//-                 required
//-               )

//-             .col-md-3
//-               label.form-label Fecha de Nacimiento
//-               input.form-control(
//-                 type="date"
//-                 name="nacimiento"
//-                 required
//-               )

//-       // =========================
//-       // USUARIO
//-       // =========================
//-       .card.mb-3.shadow-sm
//-         .card-header.bg-secondary.text-white
//-           strong Usuario

//-         .card-body
//-           .row.g-3
//-             .col-md-4
//-               label.form-label Email
//-               input.form-control(
//-                 type="email"
//-                 name="email"
//-                 required
//-               )

//-             .col-md-4
//-               label.form-label Contraseña
//-               input.form-control(
//-                 type="password"
//-                 name="password"
//-                 required
//-               )

//-             .col-md-4
//-               label.form-label Repetir Contraseña
//-               input.form-control(
//-                 type="password"
//-                 name="repeatPassword"
//-                 required
//-               )

//-       // =========================
//-       // CONFIGURACIÓN
//-       // =========================
//-       .card.mb-3.shadow-sm
//-         .card-header.bg-info.text-white
//-           strong Configuración

//-         .card-body
//-           .row.g-3
//-             .col-md-3
//-               label.form-label Rol
//-               select.form-select(
//-                 name="id_rol"
//-                 required
//-               )
//-                 option(value="4") Paciente

//-             .col-md-3
//-               label.form-label Estado
//-               select.form-select(
//-                 name="estado"
//-                 required
//-               )
//-                 option(value="") Seleccione
//-                 option(value="1") Activo
//-                 option(value="0") Inactivo

//-             .col-md-3
//-               label.form-label Teléfonos
//-               #telefonos-container
//-                 .input-group
//-                   input.form-control(
//-                     type="text"
//-                     name="telefonos[]"
//-                     placeholder="Ej: 11 1234 5678"
//-                     required
//-                   )
//-                   button.btn.btn-outline-danger(
//-                     type="button"
//-                     onclick="this.parentElement.remove()"
//-                   ) ✕

//-               button.btn.btn-outline-primary.btn-sm.mt-2(
//-                 type="button"
//-                 onclick="agregarTelefono()"
//-               )
//-                 | + Agregar teléfono

//-             .col-md-3
//-               label.form-label Obra Social
//-               select.form-select(
//-                 name="id_obra_social"
//-                 required
//-               )
//-                 option(value="") Seleccione
//-                 if obra_sociales
//-                   each obra_social in obra_sociales
//-                     option(value=obra_social.id)= obra_social.nombre
//-                 else
//-                   option(value="") No hay disponibles

//-       // =========================
//-       // BOTÓN
//-       // =========================
//-       .d-flex.justify-content-end.mt-3
//-         button.btn.btn-success.px-4(type="submit")
//-           i.bi.bi-person-plus
//-           |  Crear Paciente

//-   // =========================
//-   // SCRIPTS
//-   // =========================
//-   script.
//-     function agregarTelefono() {
//-       const cont = document.getElementById('telefonos-container');

//-       const div = document.createElement('div');
//-       div.className = 'input-group mt-2';

//-       div.innerHTML = `
//-         <input class="form-control" type="text" name="telefonos[]" placeholder="Ej: 11 1234 5678">
//-         <button class="btn btn-outline-danger" type="button">✕</button>
//-       `;

//-       div.querySelector('button').onclick = () => div.remove();
//-       cont.appendChild(div);
//-     }


//- extends ../layout

//- block contenido
//-   .container.mt-4.mb-4
//-     h2.text-center.mb-3 Crear Nuevo Paciente

//-     .d-flex.justify-content-between.mb-3
//-       a.btn.btn-outline-secondary(href="/pacientes")
//-         i.fa-solid.fa-arrow-left.me-2
//-         | Volver a Pacientes

//-     //- IMPORTANTE: Verifica que la ruta sea /pacientes
//-     form(action="/pacientes" method="POST")

//-       // =========================
//-       // DATOS PERSONALES
//-       // =========================
//-       .card.mb-3.shadow-sm
//-         .card-header.bg-primary.text-white
//-           strong Datos Personales

//-         .card-body
//-           .row.g-3
//-             .col-md-3
//-               label.form-label DNI
//-               input.form-control(type="number" name="dni" required)

//-             .col-md-3
//-               label.form-label Nombre
//-               input.form-control(type="text" name="nombre" required)

//-             .col-md-3
//-               label.form-label Apellido
//-               input.form-control(type="text" name="apellido" required)

//-             .col-md-3
//-               label.form-label Fecha de Nacimiento
//-               //- El controlador usa name="nacimiento"
//-               input.form-control(type="date" name="nacimiento" required)

//-       // =========================
//-       // USUARIO
//-       // =========================
//-       .card.mb-3.shadow-sm
//-         .card-header.bg-secondary.text-white
//-           strong Usuario

//-         .card-body
//-           .row.g-3
//-             .col-md-4
//-               label.form-label Email
//-               input.form-control(type="email" name="email" required)

//-             .col-md-4
//-               label.form-label Contraseña
//-               input.form-control(type="password" name="password" required)

//-             .col-md-4
//-               label.form-label Repetir Contraseña
//-               input.form-control(type="password" name="repeatPassword" required)

//-       // =========================
//-       // CONFIGURACIÓN
//-       // =========================
//-       .card.mb-3.shadow-sm
//-         .card-header.bg-info.text-white
//-           strong Configuración

//-         .card-body
//-           .row.g-3
//-             .col-md-3
//-               label.form-label Rol
//-               select.form-select(name="id_rol" required)
//-                 //- Cambiado a 3 si tu sistema usa 3 para pacientes, o mantén el valor correcto
//-                 option(value="3") Paciente

//-             .col-md-3
//-               label.form-label Estado
//-               select.form-select(name="estado" required)
//-                 option(value="1" selected) Activo
//-                 option(value="0") Inactivo

//-             .col-md-3
//-               label.form-label Teléfonos
//-               #telefonos-container
//-                 .input-group
//-                   //- El controlador espera "telefonos" (puede ser string o array)
//-                   input.form-control(type="text" name="telefonos" placeholder="Ej: 1122334455" required)
              
//-               button.btn.btn-outline-primary.btn-sm.mt-2(type="button" onclick="agregarTelefono()")
//-                 | + Agregar otro

//-             .col-md-3
//-               label.form-label Obra Social
//-               //- CAMBIO CLAVE: El controlador busca "obra_sociales" en el body
//-               select.form-select(name="obra_sociales" required)
//-                 option(value="") Seleccione
//-                 if obrasSociales
//-                   each os in obrasSociales
//-                     option(value=os.id)= os.nombre
//-                 else
//-                   option(value="") No hay datos

//-       .d-flex.justify-content-end.mt-3
//-         button.btn.btn-success.px-4(type="submit")
//-           i.fa-solid.fa-user-plus.me-2
//-           | Crear Paciente

//-   script.
//-     function agregarTelefono() {
//-       const cont = document.getElementById('telefonos-container');
//-       const div = document.createElement('div');
//-       div.className = 'input-group mt-2';
//-       //- Usamos el mismo name para que llegue como array al controlador
//-       div.innerHTML = `
//-         <input class="form-control" type="text" name="telefonos" placeholder="Otro teléfono">
//-         <button class="btn btn-outline-danger" type="button" onclick="this.parentElement.remove()">✕</button>
//-       `;
//-       cont.appendChild(div);
//-     }


//- extends ../layout

//- block contenido
//-   .container.mt-4.mb-5
//-     .row.justify-content-center
//-       .col-lg-10
//-         h2.text-center.mb-4.fw-bold Crear Nuevo Paciente
        
//-         //- Alert para errores de validación (si los hay)
//-         #validationAlert.alert.alert-danger.d-none
        
//-         form#formPaciente(action="/pacientes" method="POST")
//-           //- SECCIÓN 1: IDENTIDAD
//-           .card.shadow-sm.mb-4
//-             .card-header.bg-primary.text-white: strong <i class="fa-solid fa-id-card me-2"></i> Datos Personales
//-             .card-body
//-               .row.g-3
//-                 .col-md-3
//-                   label.form-label.small.fw-bold DNI
//-                   input.form-control(type="number" name="dni" required)
//-                 .col-md-3
//-                   label.form-label.small.fw-bold Nombre
//-                   input.form-control(type="text" name="nombre" required)
//-                 .col-md-3
//-                   label.form-label.small.fw-bold Apellido
//-                   input.form-control(type="text" name="apellido" required)
//-                 .col-md-3
//-                   label.form-label.small.fw-bold Fecha de Nacimiento
//-                   input.form-control(type="date" name="nacimiento" required)

//-           //- SECCIÓN 2: ACCESO
//-           .card.shadow-sm.mb-4
//-             .card-header.bg-dark.text-white: strong <i class="fa-solid fa-user-lock me-2"></i> Cuenta de Usuario
//-             .card-body
//-               .row.g-3
//-                 .col-md-4
//-                   label.form-label.small.fw-bold Email
//-                   input.form-control(type="email" name="email" required)
//-                 .col-md-4
//-                   label.form-label.small.fw-bold Contraseña
//-                   input.form-control(type="password" name="password" required)
//-                 .col-md-4
//-                   label.form-label.small.fw-bold Confirmar Contraseña
//-                   input.form-control(type="password" name="repeatPassword" required)

//-           //- SECCIÓN 3: MÉDICA Y CONTACTO
//-           .card.shadow-sm.mb-4
//-             .card-header.bg-info.text-white: strong <i class="fa-solid fa-briefcase-medical me-2"></i> Configuración y Contacto
//-             .card-body
//-               .row.g-3
//-                 .col-md-3
//-                   label.form-label.small.fw-bold Obra Social
//-                   select.form-select(name="obra_sociales" required)
//-                     option(value="" disabled selected) Seleccione...
//-                     if obrasSociales
//-                       each os in obrasSociales
//-                         option(value=os.id)= os.nombre
                
//-                 .col-md-3
//-                   label.form-label.small.fw-bold Estado
//-                   select.form-select(name="estado" required)
//-                     option(value="1" selected) Activo
//-                     option(value="0") Inactivo
                
//-                 .col-md-3
//-                   //- Importante: Enviamos id_rol como 3 (Paciente) según tu lógica
//-                   label.form-label.small.fw-bold Rol
//-                   select.form-select(name="id_rol" required)
//-                     option(value="3" selected) Paciente

//-                 .col-md-3
//-                   label.form-label.small.fw-bold Teléfonos
//-                   #telefonos-container
//-                     .input-group.mb-2
//-                       input.form-control(type="text" name="telefonos" placeholder="Ej: 2944123456" required)
//-                   button.btn.btn-sm.btn-outline-primary(type="button" onclick="agregarInputTelefono()") + Agregar otro

//-           .d-flex.justify-content-between
//-             a.btn.btn-outline-secondary.px-4(href="/pacientes") Cancelar
//-             button.btn.btn-success.px-5.fw-bold(type="submit") Guardar Paciente

//-   script.
//-     function agregarInputTelefono() {
//-       const container = document.getElementById('telefonos-container');
//-       const div = document.createElement('div');
//-       div.className = 'input-group mb-2';
//-       div.innerHTML = `
//-         <input class="form-control" type="text" name="telefonos" placeholder="Otro teléfono">
//-         <button class="btn btn-outline-danger" type="button" onclick="this.parentElement.remove()">✕</button>
//-       `;
//-       container.appendChild(div);
//-     }

//-     // Script para capturar el error 422 y mostrar qué campo falla
//-     document.getElementById('formPaciente').onsubmit = async function(e) {
//-       e.preventDefault();
//-       const formData = new FormData(this);
//-       const data = Object.fromEntries(formData.entries());
      
//-       // Manejo manual de múltiples teléfonos para que lleguen como array
//-       const telefonos = [];
//-       document.querySelectorAll('input[name="telefonos"]').forEach(i => {
//-         if(i.value) telefonos.push(i.value);
//-       });
      
//-       const payload = { ...data, telefonos };

//-       try {
//-         const res = await fetch(this.action, {
//-           method: 'POST',
//-           headers: { 'Content-Type': 'application/json' },
//-           body: JSON.stringify(payload)
//-         });

//-         if (res.status === 422) {
//-           const result = await res.json();
//-           const alertDiv = document.getElementById('validationAlert');
//-           alertDiv.classList.remove('d-none');
//-           // Mostramos exactamente qué campo de Zod/Joi falló
//-           alertDiv.innerHTML = "<strong>Error de validación:</strong><br>" + 
//-             result.error.map(err => `- ${err.path.join('.')}: ${err.message}`).join('<br>');
//-           window.scrollTo(0, 0);
//-         } else if (res.ok) {
//-           window.location.href = '/pacientes?nombreStore=true';
//-         } else {
//-           const errorData = await res.json();
//-           alert(errorData.message || "Error en el servidor");
//-         }
//-       } catch (err) {
//-         console.error("Error:", err);
//-       }
//-     };

extends ../layout

block contenido
  .container.mt-4.mb-5
    .row.justify-content-center
      .col-lg-10
        h2.text-center.mb-4.fw-bold Crear Nuevo Paciente
        
        //- El formulario ahora es estándar (sin el script de fetch complejo)
        form#formPaciente(action="/pacientes" method="POST")
          
          .card.shadow-sm.mb-4
            .card-header.bg-primary.text-white: strong Datos Personales
            .card-body
              .row.g-3
                .col-md-3
                  label.form-label.small.fw-bold DNI
                  input.form-control(type="number" name="dni" required)
                .col-md-3
                  label.form-label.small.fw-bold Nombre
                  input.form-control(type="text" name="nombre" required)
                .col-md-3
                  label.form-label.small.fw-bold Apellido
                  input.form-control(type="text" name="apellido" required)
                .col-md-3
                  label.form-label.small.fw-bold Fecha de Nacimiento
                  input.form-control(type="date" name="nacimiento" required)

          .card.shadow-sm.mb-4
            .card-header.bg-dark.text-white: strong Cuenta de Usuario
            .card-body
              .row.g-3
                .col-md-4
                  label.form-label.small.fw-bold Email
                  input.form-control(type="email" name="email" required)
                .col-md-4
                  label.form-label.small.fw-bold Contraseña
                  input#password.form-control(type="password" name="password" required)
                .col-md-4
                  label.form-label.small.fw-bold Confirmar Contraseña
                  input#repeatPassword.form-control(type="password" name="repeatPassword" required)

          .card.shadow-sm.mb-4
            .card-header.bg-info.text-white: strong Configuración y Contacto
            .card-body
              .row.g-3
                .col-md-3
                  label.form-label.small.fw-bold Obra Social
                  select.form-select(name="obra_sociales" required)
                    option(value="" disabled selected) Seleccione...
                    if obrasSociales
                      each os in obrasSociales
                        option(value=os.id)= os.nombre
                
                .col-md-3
                  label.form-label.small.fw-bold Estado
                  select.form-select(name="estado" required)
                    option(value="1" selected) Activo
                    option(value="0") Inactivo
                
                .col-md-3
                  label.form-label.small.fw-bold Rol
                  select.form-select(name="id_rol" required)
                    option(value="3" selected) Paciente

                .col-md-3
                  label.form-label.small.fw-bold Teléfonos
                  #telefonos-container
                    input.form-control(type="text" name="telefonos" placeholder="Ej: 2944123456" required)

          .d-flex.justify-content-between
            a.btn.btn-outline-secondary.px-4(href="/pacientes") Cancelar
            button.btn.btn-success.px-5.fw-bold(type="submit") Guardar Paciente

  script.
    // Validación simple antes de enviar para evitar el error 400
    document.getElementById('formPaciente').onsubmit = function(e) {
      const pass = document.getElementById('password').value;
      const repeat = document.getElementById('repeatPassword').value;
      
      if (pass !== repeat) {
        e.preventDefault(); // Detiene el envío
        alert("¡Error! Las contraseñas no coinciden. Por favor, verifica.");
        return false;
      }
    };