extends ../layout

block contenido
  .container.mt-4.mb-5
    .row.justify-content-center
      .col-lg-10
        h2.text-center.mb-4.fw-bold Crear Nuevo Paciente
        
        //- El formulario ahora es estándar (sin el script de fetch complejo)
        form#formPaciente(action="/pacientes" method="POST")
          
          .card.shadow-sm.mb-4
            .card-header.bg-primary.text-white: strong Datos Personales
            .card-body
              .row.g-3
                .col-md-3
                  label.form-label.small.fw-bold DNI
                  input.form-control(type="number" name="dni" required)
                .col-md-3
                  label.form-label.small.fw-bold Nombre
                  input.form-control(type="text" name="nombre" required)
                .col-md-3
                  label.form-label.small.fw-bold Apellido
                  input.form-control(type="text" name="apellido" required)
                .col-md-3
                  label.form-label.small.fw-bold Fecha de Nacimiento
                  input.form-control(type="date" name="nacimiento" required)

          .card.shadow-sm.mb-4
            .card-header.bg-dark.text-white: strong Cuenta de Usuario
            .card-body
              .row.g-3
                .col-md-4
                  label.form-label.small.fw-bold Email
                  input.form-control(type="email" name="email" required)
                .col-md-4
                  label.form-label.small.fw-bold Contraseña
                  input#password.form-control(type="password" name="password" required)
                .col-md-4
                  label.form-label.small.fw-bold Confirmar Contraseña
                  input#repeatPassword.form-control(type="password" name="repeatPassword" required)

          .card.shadow-sm.mb-4
            .card-header.bg-info.text-white: strong Configuración y Contacto
            .card-body
              .row.g-3
                .col-md-3
                  label.form-label.small.fw-bold Obra Social
                  select.form-select(name="obra_sociales" required)
                    option(value="" disabled selected) Seleccione...
                    if obrasSociales
                      each os in obrasSociales
                        option(value=os.id)= os.nombre
                
                .col-md-3
                  label.form-label.small.fw-bold Estado
                  select.form-select(name="estado" required)
                    option(value="1" selected) Activo
                    option(value="0") Inactivo
                
                .col-md-3
                  label.form-label.small.fw-bold Rol
                  select.form-select(name="id_rol" required)
                    option(value="3" selected) Paciente

                .col-md-3
                  label.form-label.small.fw-bold Teléfonos
                  #telefonos-container
                    input.form-control(type="text" name="telefonos" placeholder="Ej: 2944123456" required)

          .d-flex.justify-content-between
            a.btn.btn-outline-secondary.px-4(href="/pacientes") Cancelar
            button.btn.btn-success.px-5.fw-bold(type="submit") Guardar Paciente

  script.
    // Validación simple antes de enviar para evitar el error 400
    document.getElementById('formPaciente').onsubmit = function(e) {
      const pass = document.getElementById('password').value;
      const repeat = document.getElementById('repeatPassword').value;
      
      if (pass !== repeat) {
        e.preventDefault(); // Detiene el envío
        alert("¡Error! Las contraseñas no coinciden. Por favor, verifica.");
        return false;
      }
    };