//- extends ../layout

//- block contenido
//-     style.
//-         body {
//-             background-color: #eef5ff;
//-             font-family: Arial, sans-serif;
//-         }

//-         .container {
//-             padding: 20px;
//-         }

//-         .center-text {
//-             text-align: center;
//-             font-weight: bold;
//-             margin-bottom: 20px;
//-         }

//-         .right-align {
//-             display: flex;
//-             justify-content: flex-end;
//-             margin-bottom: 10px;
//-         }

//-         /* ======================= FILTROS GRID ======================= */
//-         .filters {
//-             display: grid;
//-             grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
//-             gap: 15px;
//-             margin: 20px 0;
//-             padding: 15px;
//-             background: #ffffff;
//-             border-radius: 8px;
//-             border: 1px solid #d0d7e1;
//-             box-shadow: 0px 2px 4px rgba(0,0,0,0.08);
//-         }

//-         .filter-item p {
//-             font-weight: bold;
//-             margin-bottom: 4px;
//-             font-size: 14px;
//-             color: #333;
//-         }

//-         /* ======================= CARDS ======================= */
//-         .cards-container {
//-             display: grid;
//-             grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
//-             gap: 20px;
//-             padding: 10px;
//-         }

//-         .card {
//-             border: 1px solid #ddd;
//-             border-left: 4px solid #1e88e5;
//-             border-radius: 8px;
//-             padding: 16px;
//-             background-color: #ffffff;
//-             box-shadow: 0px 2px 4px rgba(0,0,0,0.1);
//-             transition: transform .15s ease;
//-         }

//-         .card:hover {
//-             transform: translateY(-4px);
//-             box-shadow: 0px 4px 10px rgba(0,0,0,0.15);
//-         }

//-         .card-header h2 {
//-             font-weight: 700;
//-             font-size: 20px;
//-             margin: 0;
//-             color: #2b4c7e;
//-         }

//-         .card-body p {
//-             margin: 4px 0;
//-             color: #444;
//-         }

//-         .card-body p:first-child {
//-             color: #1976d2;
//-             font-weight: bold;
//-             font-size: 17px;
//-         }

//-         .card-body p:nth-child(4) {
//-             color: #ff9800;
//-             font-weight: bold;
//-         }

//-         .card-footer {
//-             margin-top: 12px;
//-             display: flex;
//-             flex-wrap: wrap;
//-             gap: 10px;
//-         }

//-         .icon-btn {
//-             font-size: 20px;
//-             cursor: pointer;
//-             padding: 6px 10px;
//-             border-radius: 6px;
//-             display: inline-flex;
//-             align-items: center;
//-             justify-content: center;
//-         }

//-         .icon-view { color: #198754; }
//-         .icon-edit { color: #0d6efd; }
//-         .icon-delete { color: #dc3545; }
//-         .icon-reserve { color: #ff9800; }
//-         .icon-create { margin-left: 6px; }

//-         .crear {
//-             margin: 20px 0;
//-         }


//-     .container
//-         .right-align
//-             a.btn.btn-primary(href="/") Iniciar Sesión

//-         h1.center-text Cartilla Médica

//-         if mensaje
//-             script.
//-                 Swal.fire({
//-                     title: 'Mensaje',
//-                     text: '#{mensaje}',
//-                     icon: 'success',
//-                     confirmButtonText: 'OK'
//-                 });

//-         // ============================ FILTROS ============================
//-         .filters
//-             .filter-item
//-                 p Especialidad
//-                 select.form-select(onchange="applyFilters()" id="f-especialidad")
//-                     option(value="") Todas
//-                     each especialidad in especialidades || []
//-                         option(value=especialidad.nombre)= especialidad.nombre

//-             .filter-item
//-                 p Clasificación
//-                 select.form-select(onchange="applyFilters()" id="f-clasificacion")
//-                     option(value="") Todas
//-                     option Normal
//-                     option Especial
//-                     option Vip

//-             .filter-item
//-                 p Médico
//-                 select.form-select(onchange="applyFilters()" id="f-medico")
//-                     option(value="") Todos
//-                     each medico in medicos || []
//-                         option(value=`${medico.apellido} ${medico.nombre}`)= `${medico.apellido} ${medico.nombre}`

//-             .filter-item
//-                 p Día
//-                 select.form-select(onchange="applyFilters()" id="f-dia")
//-                     option(value="") Todos
//-                     each dia in ["Lunes","Martes","Miercoles","Jueves","Viernes","Sábado","Domingo"]
//-                         option(value=dia)= dia

//-             .filter-item
//-                 p Turnos
//-                 select.form-select(onchange="applyFilters()" id="f-turno")
//-                     option(value="") Todos
//-                     each estado in ["Libre","Reservado","Confirmado","Cancelado","Ausente","Presente","En Consulta","Atendido","No Disponible"]
//-                         option(value=estado)= estado

//-             .filter-item
//-                 p Obra Social
//-                 select.form-select(onchange="applyFilters()" id="f-obra")
//-                     option(value="") Todas
//-                     each obra_social in obras_sociales || []
//-                         option(value=obra_social.nombre)= obra_social.nombre

//-         a.crear.btn.btn-success(href="/agendas/create")
//-             i.bi.bi-plus-circle.icon-create
//-             |  Crear Agenda

//-     // ============================ CARDS ============================
//-     .cards-container
//-         each agenda in agendas
//-             .card(
//-                 data-especialidad=agenda.especialidad
//-                 data-clasificacion=agenda.clasificacion
//-                 data-medico=`${agenda.apellido} ${agenda.nombre}`
//-                 data-dia=agenda.dias
//-                 data-turno=agenda.estado_turno
//-                 data-obra=agenda.obra_social
//-             )
//-                 .card-header
//-                     h2 #{agenda.apellido} #{agenda.nombre}

//-                 .card-body
//-                     p #{agenda.especialidad}
//-                     p #{agenda.dias}
//-                     p #{agenda.hora_inicio} a #{agenda.hora_fin} hs
//-                     p #{agenda.sucursal}
//-                     p #{agenda.obra_social}

//-                 .card-footer
//-                     // ---- ICONOS ----
//-                     a.icon-btn.icon-view(href=`/turnos/${agenda.id}` title="Ver turnos")
//-                         i.bi.bi-calendar-check

//-                     a.icon-btn.icon-edit(href=`/agendas/edit/${agenda.id}` title="Editar")
//-                         i.bi.bi-pencil-square

//-                     button.icon-btn.icon-delete(onclick=`confirmDelete(${agenda.id})` title="Eliminar")
//-                         i.bi.bi-trash

//-                     //- a.icon-btn.icon-reserve(href=`/turnos/${agenda.id}` title="Reservar turno")
//-                     //-     i.bi.bi-journal-plus


//-     // ============================ SCRIPTS ============================
//-     script.
//-         function confirmDelete(id) {
//-             Swal.fire({
//-                 title: '¿Estás seguro?',
//-                 text: "¡No podrás revertir esto!",
//-                 icon: 'warning',
//-                 showCancelButton: true,
//-                 confirmButtonColor: '#3085d6',
//-                 cancelButtonColor: '#d33',
//-                 confirmButtonText: 'Sí, eliminarlo!'
//-             }).then((result) => {
//-                 if (result.isConfirmed) deleteAgenda(id);
//-             });
//-         }

//-         function deleteAgenda(id) {
//-             fetch(`/agendas/${id}`, { method: 'DELETE' })
//-                 .then(res => {
//-                     if (!res.ok) throw new Error();
//-                     Swal.fire('Eliminado!', 'La agenda ha sido eliminada.', 'success')
//-                         .then(() => location.reload());
//-                 })
//-                 .catch(() =>
//-                     Swal.fire('Error!', 'Hubo un problema al eliminar la agenda.', 'error')
//-                 );
//-         }

//-         function applyFilters() {
//-             const filters = {
//-                 especialidad: document.getElementById('f-especialidad').value,
//-                 clasificacion: document.getElementById('f-clasificacion').value,
//-                 medico: document.getElementById('f-medico').value,
//-                 dia: document.getElementById('f-dia').value,
//-                 turno: document.getElementById('f-turno').value,
//-                 obra: document.getElementById('f-obra').value
//-             };

//-             document.querySelectorAll('.card').forEach(card => {
//-                 const match =
//-                     (filters.especialidad === "" || card.dataset.especialidad === filters.especialidad) &&
//-                     (filters.clasificacion === "" || card.dataset.clasificacion === filters.clasificacion) &&
//-                     (filters.medico === "" || card.dataset.medico === filters.medico) &&
//-                     (filters.dia === "" || card.dataset.dia.includes(filters.dia)) &&
//-                     (filters.turno === "" || card.dataset.turno === filters.turno) &&
//-                     (filters.obra === "" || card.dataset.obra === filters.obra);

//-                 card.style.display = match ? "block" : "none";
//-             });
//-         }
extends ../layout

block contenido
    style.
        body {
            background-color: #eef5ff;
            font-family: Arial, sans-serif;
        }

        .container {
            padding: 20px;
        }

        .center-text {
            text-align: center;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .right-align {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 10px;
        }

        /* ======================= FILTROS GRID ======================= */
        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: #ffffff;
            border-radius: 8px;
            border: 1px solid #d0d7e1;
            box-shadow: 0px 2px 4px rgba(0,0,0,0.08);
        }

        .filter-item p {
            font-weight: bold;
            margin-bottom: 4px;
            font-size: 14px;
            color: #333;
        }

        /* ======================= CARDS ======================= */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); /* más compacto */
            gap: 15px;
            padding: 10px;
        }

        .card {
            border: 1px solid #ddd;
            border-left: 4px solid #1e88e5;
            border-radius: 8px;
            padding: 12px; /* menos padding */
            background-color: #ffffff;
            box-shadow: 0px 2px 4px rgba(0,0,0,0.1);
            transition: transform .15s ease;
            font-size: 14px;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0px 4px 10px rgba(0,0,0,0.15);
        }

        .card-header h2 {
            font-weight: 700;
            font-size: 16px; /* más pequeño */
            margin: 0;
            color: #2b4c7e;
        }

        .card-body p {
            margin: 3px 0; /* margen reducido */
            color: #444;
        }

        .card-body p:first-child {
            color: #1976d2;
            font-weight: bold;
            font-size: 12px; /* más pequeño */
        }

        .card-body p:nth-child(4) {
            color: #ff9800;
            font-weight: bold;
        }

        .card-footer {
            margin-top: 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .icon-btn {
            font-size: 20px;
            cursor: pointer;
            padding: 6px 10px;
            border-radius: 6px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .icon-view { color: #198754; }
        .icon-edit { color: #0d6efd; }
        .icon-delete { color: #dc3545; }
        .icon-reserve { color: #ff9800; }
        .icon-create { margin-left: 6px; }

        .crear {
            margin: 20px 0;
        }

    .container
        .right-align
            a.btn.btn-primary(href="/") Iniciar Sesión

        h1.center-text Cartilla Médica

        if mensaje
            script.
                Swal.fire({
                    title: 'Mensaje',
                    text: '#{mensaje}',
                    icon: 'success',
                    confirmButtonText: 'OK'
                });

        // ============================ FILTROS ============================
        .filters
            .filter-item
                p Especialidad
                select.form-select(onchange="applyFilters()" id="f-especialidad")
                    option(value="") Todas
                    each especialidad in especialidades || []
                        option(value=especialidad.nombre)= especialidad.nombre

            .filter-item
                p Clasificación
                select.form-select(onchange="applyFilters()" id="f-clasificacion")
                    option(value="") Todas
                    option Normal
                    option Especial
                    option Vip

            .filter-item
                p Médico
                select.form-select(onchange="applyFilters()" id="f-medico")
                    option(value="") Todos
                    each medico in medicos || []
                        option(value=`${medico.apellido} ${medico.nombre}`)= `${medico.apellido} ${medico.nombre}`

            .filter-item
                p Día
                select.form-select(onchange="applyFilters()" id="f-dia")
                    option(value="") Todos
                    each dia in ["Lunes","Martes","Miercoles","Jueves","Viernes","Sábado","Domingo"]
                        option(value=dia)= dia

            .filter-item
                p Turnos
                select.form-select(onchange="applyFilters()" id="f-turno")
                    option(value="") Todos
                    each estado in ["Libre","Reservado","Confirmado","Cancelado","Ausente","Presente","En Consulta","Atendido","No Disponible"]
                        option(value=estado)= estado

            .filter-item
                p Obra Social
                select.form-select(onchange="applyFilters()" id="f-obra")
                    option(value="") Todas
                    each obra_social in obras_sociales || []
                        option(value=obra_social.nombre)= obra_social.nombre

        a.crear.btn.btn-success(href="/agendas/create")
            i.bi.bi-plus-circle.icon-create
            |  Crear Agenda

    // ============================ CARDS ============================
    .cards-container
        each agenda in agendas
            .card(
                data-especialidad=agenda.especialidad
                data-clasificacion=agenda.clasificacion
                data-medico=`${agenda.apellido} ${agenda.nombre}`
                data-dia=agenda.dias
                data-turno=agenda.estado_turno
                data-obra=agenda.obra_social
            )
                .card-header
                    h2 #{agenda.apellido} #{agenda.nombre}

                .card-body
                    p #{agenda.especialidad}
                    p #{agenda.dias}
                    p #{agenda.hora_inicio} a #{agenda.hora_fin} hs
                    p #{agenda.sucursal}
                    p #{agenda.obra_social}

                .card-footer
                    a.icon-btn.icon-view(href=`/turnos/${agenda.id}` title="Ver turnos")
                        i.bi.bi-calendar-check

                    a.icon-btn.icon-edit(href=`/agendas/edit/${agenda.id}` title="Editar")
                        i.bi.bi-pencil-square

                    button.icon-btn.icon-delete(onclick=`confirmDelete(${agenda.id})` title="Eliminar")
                        i.bi.bi-trash

    // ============================ SCRIPTS ============================
    script.
        function confirmDelete(id) {
            Swal.fire({
                title: '¿Estás seguro?',
                text: "¡No podrás revertir esto!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Sí, eliminarlo!'
            }).then((result) => {
                if (result.isConfirmed) deleteAgenda(id);
            });
        }

        function deleteAgenda(id) {
            fetch(`/agendas/${id}`, { method: 'DELETE' })
                .then(res => {
                    if (!res.ok) throw new Error();
                    Swal.fire('Eliminado!', 'La agenda ha sido eliminada.', 'success')
                        .then(() => location.reload());
                })
                .catch(() =>
                    Swal.fire('Error!', 'Hubo un problema al eliminar la agenda.', 'error')
                );
        }

        function applyFilters() {
            const filters = {
                especialidad: document.getElementById('f-especialidad').value,
                clasificacion: document.getElementById('f-clasificacion').value,
                medico: document.getElementById('f-medico').value,
                dia: document.getElementById('f-dia').value,
                turno: document.getElementById('f-turno').value,
                obra: document.getElementById('f-obra').value
            };

            document.querySelectorAll('.card').forEach(card => {
                const match =
                    (filters.especialidad === "" || card.dataset.especialidad === filters.especialidad) &&
                    (filters.clasificacion === "" || card.dataset.clasificacion === filters.clasificacion) &&
                    (filters.medico === "" || card.dataset.medico === filters.medico) &&
                    (filters.dia === "" || card.dataset.dia.includes(filters.dia)) &&
                    (filters.turno === "" || card.dataset.turno === filters.turno) &&
                    (filters.obra === "" || card.dataset.obra === filters.obra);

                card.style.display = match ? "block" : "none";
            });
        }
